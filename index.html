<!DOCTYPE html>
<html lang="en">
<head>
    <!-- ============================================
         META TAGS SECTION
         These tell the browser and phone how to display the app
         ============================================ -->
    <meta charset="UTF-8">
    <!-- Makes the app look good on phones by setting the viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <!-- These three tags make the app work like a native iPhone app when added to home screen -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Golf Tracker">
    <!-- Title that appears in browser tab -->
    <title>Golf Course Tracker</title>
    <!-- Favicon - the little icon shown in the browser tab -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üèåÔ∏è</text></svg>">
    
    <!-- ============================================
         FIREBASE - CLOUD SYNC
         Enables syncing data across all your devices
         ============================================ -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    
    <!-- ============================================
         CSS STYLES SECTION
         This controls how everything looks (colors, sizes, spacing, etc.)
         ============================================ -->
    <style>
        /* ==========================================
           RESET STYLES
           Removes default browser spacing so we start clean
           ========================================== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* ==========================================
           MAIN PAGE BACKGROUND & LAYOUT
           Sets the blue gradient background and basic page structure
           ========================================== */
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            padding: 20px;
            padding-bottom: 80px;
        }

        /* ==========================================
           CONTAINER
           Centers content and sets max width for readability
           ========================================== */
        .container {
            max-width: 600px;
            margin: 0 auto;
        }

        /* ==========================================
           PAGE TITLE (‚õ≥ Golf Course Tracker)
           Styles the main heading at the top
           ========================================== */
        /* ==========================================
           TOP HEADER BAR
           Title on the left, user info on the right
           ========================================== */
        .top-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .title-animation-area {
            flex: 1;
            min-width: 0;
        }

        .putt-animation {
            width: 100%;
            max-width: 380px;
            height: 62px;
        }

        /* Putter swing - gentle pendulum like a real putt */
        .putter-swing {
            animation: putterStroke 1.0s ease-in-out forwards;
        }
        @keyframes putterStroke {
            0%   { transform: rotate(6deg); }
            30%  { transform: rotate(6deg); }
            55%  { transform: rotate(-3deg); }
            75%  { transform: rotate(-5deg); }
            100% { transform: rotate(-3deg); }
        }

        /* Ball rolls smoothly under text, gradually decelerating, then curves up to period */
        .rolling-ball {
            animation: ballRollPath 3s linear 0.55s forwards;
        }
        @keyframes ballRollPath {
            0%   { transform: translate(0px, 0px); opacity: 1; }
            5%   { transform: translate(22px, 0px); opacity: 1; }
            10%  { transform: translate(44px, 0px); opacity: 1; }
            15%  { transform: translate(65px, 0px); opacity: 1; }
            20%  { transform: translate(85px, 0px); opacity: 1; }
            25%  { transform: translate(104px, 0px); opacity: 1; }
            30%  { transform: translate(122px, 0px); opacity: 1; }
            35%  { transform: translate(139px, 0px); opacity: 1; }
            40%  { transform: translate(155px, 0px); opacity: 1; }
            45%  { transform: translate(170px, 0px); opacity: 1; }
            50%  { transform: translate(184px, 0px); opacity: 1; }
            55%  { transform: translate(197px, 0px); opacity: 1; }
            60%  { transform: translate(209px, 0px); opacity: 1; }
            65%  { transform: translate(220px, 0px); opacity: 1; }
            70%  { transform: translate(230px, 0px); opacity: 1; }
            75%  { transform: translate(239px, 0px); opacity: 1; }
            80%  { transform: translate(247px, 0px); opacity: 1; }
            85%  { transform: translate(254px, 0px); opacity: 1; }
            90%  { transform: translate(260px, 0px); opacity: 1; }
            93%  { transform: translate(265px, 0px); opacity: 1; }
            96%  { transform: translate(268px, -3px); opacity: 1; }
            100% { transform: translate(269px, -8px); opacity: 0; }
        }

        /* The period dot fades in exactly where the ball ends */
        .end-dot {
            animation: dotAppear 0.2s ease-in 3.45s forwards;
        }
        @keyframes dotAppear {
            0%   { opacity: 0; }
            100% { opacity: 1; }
        }

        h1 {
            color: white;
            font-size: 22px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
            margin: 0;
            white-space: nowrap;
        }

        .user-bar-right {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* ==========================================
           VIEW TOGGLE BUTTONS (My Courses / Add Course)
           The two buttons that switch between list view and add form
           ========================================== */
        .view-toggle {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .view-toggle button {
            flex: 1;
            padding: 12px;
            border: none;
            background: rgba(255,255,255,0.2);
            color: white;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
        }

        /* Active button style (the one currently selected) */
        .view-toggle button.active {
            background: white;
            color: #1e3c72;
            font-weight: 600;
        }

        /* ==========================================
           CARD COMPONENT
           White rounded boxes that contain forms and content
           ========================================== */
        .card {
            background: white;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.15);
        }

        /* ==========================================
           FORM INPUT STYLES
           All text inputs, dropdowns, and text areas
           ========================================== */
        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
            font-size: 14px;
        }

        input[type="text"],
        input[type="email"],
        input[type="password"],
        textarea,
        select,
        input[type="date"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            font-family: inherit;
            transition: border-color 0.3s;
        }

        /* ==========================================
           AUTOCOMPLETE DROPDOWN STYLES
           Dropdown that appears when typing course names
           ========================================== */
        .autocomplete-container {
            position: relative;
            width: 100%;
        }

        .autocomplete-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 2px solid #2a5298;
            border-top: none;
            border-radius: 0 0 8px 8px;
            max-height: 300px;
            overflow-y: auto;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            display: none;
        }

        .autocomplete-dropdown.active {
            display: block;
        }

        .autocomplete-item {
            padding: 12px;
            cursor: pointer;
            border-bottom: 1px solid #f0f0f0;
            transition: background 0.2s;
        }

        .autocomplete-item:last-child {
            border-bottom: none;
        }

        .autocomplete-item:hover {
            background: #f5f9ff;
        }

        .autocomplete-item-name {
            font-weight: 600;
            color: #1e3c72;
            margin-bottom: 4px;
        }

        .autocomplete-item-location {
            font-size: 13px;
            color: #666;
        }

        .autocomplete-loading {
            padding: 12px;
            text-align: center;
            color: #666;
            font-size: 14px;
        }

        .autocomplete-no-results {
            padding: 12px;
            text-align: center;
            color: #999;
            font-size: 14px;
        }

        /* When user clicks into an input field, highlight it with blue border */
        input[type="text"]:focus,
        input[type="email"]:focus,
        input[type="password"]:focus,
        textarea:focus,
        select:focus,
        input[type="date"]:focus {
            outline: none;
            border-color: #2a5298;
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        /* ==========================================
           RATING SYSTEM STYLES
           The three clickable rating options (Must Play, Would Like, If Nearby)
           ========================================== */
        .rating-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .rating-option {
            display: flex;
            align-items: center;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        /* Hover effect when mouse moves over a rating option */
        .rating-option:hover {
            border-color: #2a5298;
            background: #f5f9ff;
        }

        .rating-option input[type="radio"] {
            margin-right: 12px;
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        /* When a rating is selected, highlight it */
        .rating-option.selected {
            border-color: #2a5298;
            background: #f5f9ff;
        }

        .rating-label {
            flex: 1;
        }

        .rating-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 2px;
        }

        .rating-desc {
            font-size: 13px;
            color: #666;
        }

        /* ==========================================
           BUTTON STYLES
           Primary buttons (blue) and secondary buttons (gray)
           ========================================== */
        .btn {
            width: 100%;
            padding: 16px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #2a5298;
            color: white;
        }

        /* Hover effect - button lifts up slightly and changes color */
        .btn-primary:hover {
            background: #1e3c72;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(42, 82, 152, 0.3);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
            margin-top: 10px;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        /* ==========================================
           COURSE LIST STYLES
           The list of all golf courses you've added
           ========================================== */
        .course-list {
            display: none;
        }

        /* Only show when "active" class is added */
        .course-list.active {
            display: block;
        }

        /* Sort controls */
        .sort-controls {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 4px;
            margin-bottom: 8px;
        }
        .sort-label {
            font-size: 12px;
            color: rgba(255,255,255,0.7);
            white-space: nowrap;
        }
        .sort-buttons {
            display: flex;
            gap: 4px;
            flex-wrap: wrap;
        }
        .sort-btn {
            padding: 5px 12px;
            border: 1px solid rgba(255,255,255,0.3);
            border-radius: 16px;
            background: rgba(255,255,255,0.1);
            color: rgba(255,255,255,0.8);
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .sort-btn:hover {
            background: rgba(255,255,255,0.2);
        }
        .sort-btn.active {
            background: rgba(255,255,255,0.9);
            color: #1e3c72;
            font-weight: 600;
            border-color: white;
        }
        .state-group-header {
            font-size: 14px;
            font-weight: 700;
            color: rgba(255,255,255,0.9);
            padding: 10px 4px 4px;
            border-bottom: 1px solid rgba(255,255,255,0.2);
            margin-bottom: 6px;
            margin-top: 8px;
        }
        .state-group-header:first-child {
            margin-top: 0;
        }
        .map-filter-container {
            background: white;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
        }
        .map-filter-row {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            align-items: center;
        }
        .map-filter-select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            flex: 1;
            min-width: 120px;
        }
        .map-filter-clear {
            padding: 8px 12px;
            border: none;
            border-radius: 8px;
            background: #e8e8e8;
            color: #333;
            font-size: 13px;
            cursor: pointer;
        }
        .map-view-container {
            background: white;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
        }
        .map-breadcrumb {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-bottom: 12px;
            font-size: 13px;
            flex-wrap: wrap;
        }
        .map-breadcrumb-item {
            color: #2c5f2d;
            cursor: pointer;
            text-decoration: underline;
        }
        .map-breadcrumb-item:hover {
            color: #1a3d1a;
        }
        .map-breadcrumb-separator {
            color: #999;
        }
        .map-breadcrumb-current {
            color: #333;
            font-weight: 600;
        }
        .map-globe-container {
            text-align: center;
            margin-bottom: 12px;
        }
        .map-globe-container svg {
            max-width: 100%;
            height: auto;
        }
        .map-region-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 8px;
        }
        .map-region-card {
            background: #f5f9f5;
            border: 1px solid #e0e8e0;
            border-radius: 10px;
            padding: 12px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
        }
        .map-region-card:hover {
            background: #e8f5e8;
            border-color: #2c5f2d;
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .map-region-name {
            font-weight: 600;
            font-size: 14px;
            color: #1e3c72;
        }
        .map-region-count {
            font-size: 12px;
            color: #666;
            margin-top: 2px;
        }
        .map-region-flag {
            font-size: 24px;
            margin-bottom: 4px;
        }

        /* Individual course item in the list */
        .course-item {
            background: white;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: all 0.3s;
        }

        /* When hovering over a course, lift it up */
        .course-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(0,0,0,0.15);
        }

        .course-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 8px;
        }

        .course-name {
            font-size: 18px;
            font-weight: 700;
            color: #1e3c72;
            flex: 1;
        }

        /* ==========================================
           RATING BADGES
           Colored badges showing course rating (Must Play, Would Like, If Nearby)
           ========================================== */
        .course-rating {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            white-space: nowrap;
            margin-left: 10px;
        }

        /* Red badge for "Must Play" courses */
        .rating-must {
            background: #dc3545;
            color: white;
        }

        /* Yellow badge for "Would Like" courses */
        .rating-would {
            background: #ffc107;
            color: #333;
        }

        /* Green badge for "If Nearby" courses */
        .rating-nearby {
            background: #28a745;
            color: white;
        }

        /* Badge showing how many times you've played a course */
        .times-played-badge {
            background: #6c757d;
            color: white;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            margin-left: 6px;
        }

        /* ==========================================
           COURSE DETAILS (location, source info)
           Text shown under course name in the list
           ========================================== */
        .course-location {
            color: #666;
            font-size: 14px;
            margin-bottom: 4px;
        }

        .course-source {
            color: #999;
            font-size: 13px;
            font-style: italic;
        }

        /* Clickable map pin links */
        .map-link {
            text-decoration: none;
            display: block;
            cursor: pointer;
            transition: color 0.2s;
        }
        .map-link:hover {
            color: #2a5298 !important;
            text-decoration: underline;
        }

        /* Website link in wishlist card */
        .course-website-link {
            display: block;
            color: #2a5298;
            font-size: 12px;
            text-decoration: none;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            max-width: 200px;
            transition: color 0.2s;
        }
        .course-website-link:hover {
            color: #1e3c72;
            text-decoration: underline;
        }

        /* Golf Digest Ranking Badge */
        .gd-ranking {
            text-align: center;
            background: linear-gradient(135deg, #0b5e1f, #1a8a3a);
            color: white;
            border-radius: 8px;
            padding: 6px 10px;
            min-width: 70px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.15);
        }
        .gd-ranking-label {
            font-size: 9px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            opacity: 0.85;
            font-weight: 600;
        }
        .gd-ranking-number {
            font-size: 22px;
            font-weight: 800;
            line-height: 1.1;
        }
        .gd-ranking-list {
            font-size: 8px;
            text-transform: uppercase;
            opacity: 0.75;
            letter-spacing: 0.3px;
            margin-top: 1px;
        }

        /* ==========================================
           EMPTY STATE
           What shows when you haven't added any courses yet
           ========================================== */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #666;
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }

        /* ==========================================
           COURSE DETAIL MODAL (Popup)
           The popup window that shows when you click a course
           ========================================== */
        .course-detail-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            padding: 20px;
            overflow-y: auto;
        }

        /* Show modal when "active" class is added */
        .course-detail-modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            border-radius: 16px;
            padding: 24px;
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
        }

        /* X button to close the modal */
        .modal-close {
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: #999;
            padding: 0;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .detail-section {
            margin-bottom: 20px;
        }

        .detail-label {
            font-weight: 600;
            color: #666;
            font-size: 13px;
            text-transform: uppercase;
            margin-bottom: 6px;
        }

        .detail-value {
            color: #333;
            font-size: 16px;
        }

        /* Red delete button */
        .btn-delete {
            background: #dc3545;
            color: white;
        }

        .btn-delete:hover {
            background: #c82333;
        }

        /* ==========================================
           UTILITY STYLES
           Small helper styles used in various places
           ========================================== */
        .loading {
            display: inline-block;
            margin-left: 8px;
            opacity: 0.6;
        }

        #addForm {
            display: none;
        }

        #addForm.active {
            display: block;
        }

        .address-lookup {
            font-size: 13px;
            color: #666;
            margin-top: 4px;
        }

        /* ==========================================
           LOADING SCREEN
           Shown briefly while Firebase checks auth state
           ========================================== */
        #loadingScreen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 60vh;
            color: white;
        }
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255,255,255,0.3);
            border-top: 4px solid white;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin-bottom: 16px;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* ==========================================
           AUTH SCREEN (Login / Sign Up / Reset)
           ========================================== */
        #authScreen { display: none; }
        .auth-card {
            background: white;
            border-radius: 16px;
            padding: 32px 28px;
            max-width: 440px;
            margin: 0 auto;
            box-shadow: 0 12px 40px rgba(0,0,0,0.25);
        }
        .auth-card h2 { color: #1e3c72; text-align: center; margin-bottom: 8px; font-size: 22px; }
        .auth-subtitle { text-align: center; color: #666; font-size: 14px; margin-bottom: 24px; }
        .auth-error {
            background: #fff3f3; border: 1px solid #ffcccc; color: #cc0000;
            padding: 10px 14px; border-radius: 8px; font-size: 14px;
            margin-bottom: 16px; display: none;
        }
        .auth-success {
            background: #f0fff4; border: 1px solid #c6f6d5; color: #276749;
            padding: 10px 14px; border-radius: 8px; font-size: 14px;
            margin-bottom: 16px; display: none;
        }
        .auth-link { text-align: center; margin-top: 16px; font-size: 14px; color: #666; }
        .auth-link a { color: #2a5298; text-decoration: none; font-weight: 600; cursor: pointer; }
        .auth-link a:hover { text-decoration: underline; }
        .auth-divider { display: flex; align-items: center; margin: 20px 0; color: #999; font-size: 13px; }
        .auth-divider::before, .auth-divider::after { content: ''; flex: 1; border-bottom: 1px solid #e0e0e0; }
        .auth-divider::before { margin-right: 12px; }
        .auth-divider::after { margin-left: 12px; }

        /* ==========================================
           USER BAR (shows who's logged in)
           ========================================== */
        .user-bar-email {
            color: rgba(255,255,255,0.85); font-size: 12px;
            overflow: hidden; text-overflow: ellipsis; white-space: nowrap;
            max-width: 120px;
        }
        .btn-logout {
            background: rgba(255,255,255,0.2); color: white;
            border: 1px solid rgba(255,255,255,0.3);
            padding: 5px 10px; border-radius: 6px; font-size: 12px;
            cursor: pointer; transition: all 0.3s; font-weight: 500;
        }
        .btn-logout:hover { background: rgba(255,255,255,0.35); }

        /* Main app hidden by default until login */
        #mainApp { display: none; }

        /* Golf Quote Banner */
        .golf-quote {
            color: rgba(255,255,255,0.85);
            font-style: italic;
            font-size: 14px;
            text-align: center;
            padding: 0px 16px;
            margin-bottom: 8px;
            margin-top: -10px;
            line-height: 1.5;
        }
        .golf-quote-author {
            font-style: normal;
            font-weight: 600;
            font-size: 12px;
            color: rgba(255,255,255,0.6);
            margin-top: 4px;
        }

        /* Disabled button style */
        .btn:disabled { opacity: 0.6; cursor: not-allowed; transform: none !important; }

        /* ==========================================
           PLAYER CHIPS
           Individual person badges in the "Played With" section
           ========================================== */
        .player-chip {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: #f0f4ff;
            border: 1px solid #c8d6f0;
            border-radius: 8px;
            padding: 10px 12px;
            margin-bottom: 8px;
        }
        .player-chip-info {
            flex: 1;
        }
        .player-chip-name {
            font-weight: 600;
            color: #1e3c72;
            font-size: 15px;
        }
        .player-chip-detail {
            font-size: 12px;
            color: #666;
            margin-top: 2px;
        }
        .player-chip-remove {
            background: none;
            border: none;
            color: #cc0000;
            font-size: 20px;
            cursor: pointer;
            padding: 0 0 0 12px;
            line-height: 1;
        }
        .player-chip-remove:hover {
            color: #ff0000;
        }

        /* ==========================================
           PHOTO THUMBNAILS
           Preview images in the form and detail modal
           ========================================== */
        .photo-thumb-container {
            position: relative;
            display: inline-block;
        }
        .photo-thumb {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 8px;
            border: 2px solid #e0e0e0;
            cursor: pointer;
            transition: border-color 0.2s;
        }
        .photo-thumb:hover {
            border-color: #2a5298;
        }
        .photo-thumb-remove {
            position: absolute;
            top: -6px;
            right: -6px;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 50%;
            width: 22px;
            height: 22px;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1;
            box-shadow: 0 1px 3px rgba(0,0,0,0.3);
        }
        .photo-thumb-remove:hover {
            background: #c82333;
        }
        /* Full-size photo viewer overlay */
        .photo-viewer {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.9);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }
        .photo-viewer.active {
            display: flex;
        }
        .photo-viewer img {
            max-width: 95%;
            max-height: 95%;
            border-radius: 8px;
        }
        /* Detail modal photo grid */
        .detail-photos {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        .detail-photo {
            width: 100px;
            height: 100px;
            object-fit: cover;
            border-radius: 8px;
            border: 2px solid #e0e0e0;
            cursor: pointer;
            transition: border-color 0.2s;
        }
        .detail-photo:hover {
            border-color: #2a5298;
        }

        /* Photo thumbnails in the played list cards */
        .list-photo-strip {
            display: flex;
            gap: 6px;
            margin-top: 10px;
            align-items: center;
        }
        .list-photo-thumb {
            width: 56px;
            height: 56px;
            object-fit: cover;
            border-radius: 6px;
            border: 2px solid #e0e0e0;
        }
        .list-photo-more {
            width: 56px;
            height: 56px;
            border-radius: 6px;
            background: #f0f0f0;
            border: 2px solid #e0e0e0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 13px;
            font-weight: 600;
            color: #666;
        }
    </style>
</head>
<body>
    <!-- ============================================
         MAIN CONTAINER
         Everything inside here is centered on the page
         ============================================ -->
    <div class="container">
        <!-- Top header bar: title on left, user info on right -->
        <div class="top-header">
            <div class="title-animation-area">
                <svg class="putt-animation" id="puttSvg" viewBox="0 0 400 62" xmlns="http://www.w3.org/2000/svg">
                    <!-- Golfer in putting stance ‚Äî proper bent-over posture -->
                    <g class="golfer-group" transform="translate(18, -12)">
                        <!-- Back foot (planted, slightly angled) -->
                        <polygon points="-6,56 -3,56 -1,58 -7,58" fill="#2c2c2c"/>
                        <!-- Front foot -->
                        <polygon points="6,56 9,56 11,58 5,58" fill="#2c2c2c"/>
                        
                        <!-- Back leg (pants - khaki) -->
                        <line x1="0" y1="38" x2="-3" y2="56" stroke="#c4a96a" stroke-width="3.5" stroke-linecap="round"/>
                        <!-- Front leg -->
                        <line x1="2" y1="38" x2="7" y2="56" stroke="#c4a96a" stroke-width="3.5" stroke-linecap="round"/>
                        
                        <!-- Torso (polo shirt - dark blue) ‚Äî bent well forward -->
                        <line x1="1" y1="38" x2="6" y2="22" stroke="#1a3a6b" stroke-width="4.5" stroke-linecap="round"/>
                        
                        <!-- Head (skin tone) -->
                        <circle cx="9" cy="14" r="4" fill="#f0c8a0"/>
                        
                        <!-- Hat (red cap) -->
                        <ellipse cx="10" cy="11.5" rx="5.5" ry="2.5" fill="#cc2222"/>
                        <!-- Hat brim -->
                        <line x1="6" y1="12.5" x2="16" y2="11" stroke="#cc2222" stroke-width="1.5" stroke-linecap="round"/>
                        
                        <!-- Back arm (upper) -->
                        <line x1="5" y1="24" x2="9" y2="30" stroke="#1a3a6b" stroke-width="2.5" stroke-linecap="round"/>
                        <!-- Back arm (forearm - skin) -->
                        <line x1="9" y1="30" x2="13" y2="36" stroke="#f0c8a0" stroke-width="2.2" stroke-linecap="round"/>
                        
                        <!-- Front arm (upper) -->
                        <line x1="6" y1="23" x2="10" y2="29" stroke="#1a3a6b" stroke-width="2.5" stroke-linecap="round"/>
                        <!-- Front arm (forearm - skin) -->
                        <line x1="10" y1="29" x2="13" y2="36" stroke="#f0c8a0" stroke-width="2.2" stroke-linecap="round"/>
                        
                        <!-- Hands (gloves) -->
                        <circle cx="13" cy="36" r="1.8" fill="#eee"/>
                        
                        <!-- Putter (swings from hands) -->
                        <g class="putter-swing" transform-origin="13 36">
                            <!-- Putter shaft (silver) -->
                            <line x1="13" y1="36" x2="15" y2="54" stroke="#ccc" stroke-width="1.3" stroke-linecap="round"/>
                            <!-- Putter head (darker) -->
                            <rect x="13" y="53" width="6" height="2" rx="0.8" fill="#999"/>
                        </g>
                    </g>

                    <!-- Title text -->
                    <text id="titleText" x="46" y="36" fill="white" font-family="inherit" font-weight="bold" font-size="22">Golf Course Tracker</text>

                    <!-- Golf ball ‚Äî rolls below text then curves up to become period -->
                    <circle class="rolling-ball" cx="36" cy="42" r="2.2" fill="white"/>

                    <!-- The period dot ‚Äî positioned by JS right after text ends -->
                    <circle class="end-dot" id="endDot" cx="280" cy="34" r="2.2" fill="white" opacity="0"/>
                </svg>
            </div>
            <div id="userBarArea" class="user-bar-right" style="display: none;">
                <div class="user-bar-email" id="userBarEmail"></div>
                <button class="btn-logout" id="btnLogout">Sign Out</button>
            </div>
        </div>

        <!-- Position the end dot precisely after the text -->
        <script>
        (function() {
            try {
                var txt = document.getElementById('titleText');
                var dot = document.getElementById('endDot');
                if (txt && dot) {
                    var bbox = txt.getBBox();
                    var dotX = bbox.x + bbox.width + 4;
                    var dotY = bbox.y + bbox.height - 4;
                    dot.setAttribute('cx', dotX);
                    dot.setAttribute('cy', dotY);
                    // Calculate ball travel distance (ball starts at cx=36, cy=42)
                    var totalX = dotX - 36;
                    var totalY = -(42 - dotY);
                    // Update the keyframes dynamically using transform
                    var sheets = document.styleSheets;
                    for (var i = 0; i < sheets.length; i++) {
                        try {
                            var rules = sheets[i].cssRules;
                            for (var j = 0; j < rules.length; j++) {
                                if (rules[j].name === 'ballRollPath') {
                                    sheets[i].deleteRule(j);
                                    sheets[i].insertRule(
                                        '@keyframes ballRollPath {' +
                                        '0%   { transform: translate(0px, 0px); opacity: 1; }' +
                                        '5%   { transform: translate(' + (totalX * 0.08) + 'px, 0px); opacity: 1; }' +
                                        '10%  { transform: translate(' + (totalX * 0.16) + 'px, 0px); opacity: 1; }' +
                                        '15%  { transform: translate(' + (totalX * 0.24) + 'px, 0px); opacity: 1; }' +
                                        '20%  { transform: translate(' + (totalX * 0.32) + 'px, 0px); opacity: 1; }' +
                                        '25%  { transform: translate(' + (totalX * 0.39) + 'px, 0px); opacity: 1; }' +
                                        '30%  { transform: translate(' + (totalX * 0.46) + 'px, 0px); opacity: 1; }' +
                                        '35%  { transform: translate(' + (totalX * 0.52) + 'px, 0px); opacity: 1; }' +
                                        '40%  { transform: translate(' + (totalX * 0.58) + 'px, 0px); opacity: 1; }' +
                                        '45%  { transform: translate(' + (totalX * 0.63) + 'px, 0px); opacity: 1; }' +
                                        '50%  { transform: translate(' + (totalX * 0.68) + 'px, 0px); opacity: 1; }' +
                                        '55%  { transform: translate(' + (totalX * 0.73) + 'px, 0px); opacity: 1; }' +
                                        '60%  { transform: translate(' + (totalX * 0.77) + 'px, 0px); opacity: 1; }' +
                                        '65%  { transform: translate(' + (totalX * 0.81) + 'px, 0px); opacity: 1; }' +
                                        '70%  { transform: translate(' + (totalX * 0.85) + 'px, 0px); opacity: 1; }' +
                                        '75%  { transform: translate(' + (totalX * 0.89) + 'px, 0px); opacity: 1; }' +
                                        '80%  { transform: translate(' + (totalX * 0.92) + 'px, 0px); opacity: 1; }' +
                                        '85%  { transform: translate(' + (totalX * 0.94) + 'px, 0px); opacity: 1; }' +
                                        '90%  { transform: translate(' + (totalX * 0.96) + 'px, 0px); opacity: 1; }' +
                                        '93%  { transform: translate(' + (totalX * 0.98) + 'px, 0px); opacity: 1; }' +
                                        '96%  { transform: translate(' + (totalX * 0.99) + 'px, ' + (totalY * 0.4) + 'px); opacity: 1; }' +
                                        '100% { transform: translate(' + totalX + 'px, ' + totalY + 'px); opacity: 0; }' +
                                        '}', j
                                    );
                                    break;
                                }
                            }
                        } catch(e) {}
                    }
                }
            } catch(e) { console.log('Animation positioning skipped'); }
        })();
        </script>

        <!-- ============================================
             LOADING SCREEN
             Shown while Firebase checks if you're already logged in
             ============================================ -->
        <div id="loadingScreen">
            <div class="loading-spinner"></div>
            <div>Loading...</div>
        </div>

        <!-- ============================================
             AUTH SCREEN (Login / Sign Up / Reset Password)
             Only shows when NOT logged in
             ============================================ -->
        <div id="authScreen">
            <!-- LOGIN FORM -->
            <div id="loginView" class="auth-card">
                <h2>Welcome Back</h2>
                <p class="auth-subtitle">Sign in to access your courses</p>
                <div id="loginError" class="auth-error"></div>
                <div class="form-group">
                    <label for="loginEmail">Email</label>
                    <input type="email" id="loginEmail" placeholder="you@example.com" autocomplete="email">
                </div>
                <div class="form-group">
                    <label for="loginPassword">Password</label>
                    <input type="password" id="loginPassword" placeholder="Your password" autocomplete="current-password">
                </div>
                <button id="btnLogin" class="btn btn-primary">Sign In</button>
                <div class="auth-link" style="margin-top: 12px;"><a id="linkForgotPassword">Forgot password?</a></div>
                <div class="auth-divider">or</div>
                <div class="auth-link">Don't have an account? <a id="linkShowSignup">Sign Up</a></div>
            </div>

            <!-- SIGN UP FORM -->
            <div id="signupView" class="auth-card" style="display: none;">
                <h2>Create Account</h2>
                <p class="auth-subtitle">Start tracking your golf courses</p>
                <div id="signupError" class="auth-error"></div>
                <div class="form-group">
                    <label for="signupName">Display Name</label>
                    <input type="text" id="signupName" placeholder="Your name" autocomplete="name">
                </div>
                <div class="form-group">
                    <label for="signupEmail">Email</label>
                    <input type="email" id="signupEmail" placeholder="you@example.com" autocomplete="email">
                </div>
                <div class="form-group">
                    <label for="signupPassword">Password</label>
                    <input type="password" id="signupPassword" placeholder="At least 6 characters" autocomplete="new-password">
                </div>
                <div class="form-group">
                    <label for="signupConfirm">Confirm Password</label>
                    <input type="password" id="signupConfirm" placeholder="Re-enter password" autocomplete="new-password">
                </div>
                <button id="btnSignup" class="btn btn-primary">Create Account</button>
                <div class="auth-divider">or</div>
                <div class="auth-link">Already have an account? <a id="linkShowLogin">Sign In</a></div>
            </div>

            <!-- FORGOT PASSWORD FORM -->
            <div id="resetView" class="auth-card" style="display: none;">
                <h2>Reset Password</h2>
                <p class="auth-subtitle">We'll send you a link to reset your password</p>
                <div id="resetError" class="auth-error"></div>
                <div id="resetSuccess" class="auth-success"></div>
                <div class="form-group">
                    <label for="resetEmail">Email</label>
                    <input type="email" id="resetEmail" placeholder="you@example.com" autocomplete="email">
                </div>
                <button id="btnReset" class="btn btn-primary">Send Reset Link</button>
                <div class="auth-link" style="margin-top: 16px;"><a id="linkBackToLogin">‚Üê Back to Sign In</a></div>
            </div>
        </div>

        <!-- ============================================
             MAIN APP (only visible after login)
             ============================================ -->
        <div id="mainApp">

            <!-- Golf Quote Banner -->
            <div id="golfQuote" class="golf-quote"></div>

        <!-- ============================================
             VIEW TOGGLE BUTTONS
             Three buttons to switch between Wish List, Played List, and Add Course
             ============================================ -->
        <div class="view-toggle">
            <button id="btnShowWishList" class="active">Wish List</button>
            <button id="btnShowPlayedList">Played</button>
            <button id="btnShowAdd">Add</button>
        </div>

        <!-- ============================================
             ADD COURSE FORM
             This form is hidden by default. Shows when you click "Add"
             Has different fields depending on Wish List vs Played
             ============================================ -->
        <div id="addForm" class="card">
            <h2 style="margin-bottom: 20px; color: #1e3c72;">Add Course</h2>
            
            <form id="courseForm">
                <!-- Choose between Wish List or Played -->
                <div class="form-group">
                    <label>Add to:</label>
                    <div class="rating-options">
                        <label class="rating-option list-type-option">
                            <input type="radio" name="listType" value="wishlist" checked>
                            <div class="rating-label">
                                <div class="rating-title">‚≠ê Wish List</div>
                                <div class="rating-desc">Courses you want to play</div>
                            </div>
                        </label>
                        <label class="rating-option list-type-option">
                            <input type="radio" name="listType" value="played">
                            <div class="rating-label">
                                <div class="rating-title">‚úÖ Played</div>
                                <div class="rating-desc">Courses you've already played</div>
                            </div>
                        </label>
                    </div>
                </div>

                <!-- Course Name Input (Required) -->
                <div class="form-group">
                    <label for="courseName">Course Name *</label>
                    <div style="display: grid; grid-template-columns: 1fr auto; gap: 10px;">
                        <div class="autocomplete-container">
                            <input type="text" id="courseName" required placeholder="e.g., Pebble Beach Golf Links" autocomplete="off">
                            <div class="autocomplete-dropdown" id="autocompleteDropdown"></div>
                        </div>
                        <button type="button" id="btnRefreshInfo" class="btn btn-secondary" style="margin: 0; padding: 12px 16px; font-size: 14px; white-space: nowrap;" title="Look up address and website for this course">üîÑ Update Address/Website</button>
                    </div>
                    <!-- This div shows "Looking up address..." or "Address found" messages -->
                    <div class="address-lookup" id="addressLookupStatus"></div>
                </div>

                <!-- ============================================
                     SHARED LOCATION FIELDS (for both Wishlist and Played)
                     ============================================ -->
                <!-- Address Input (Auto-filled by looking up the course name) -->
                <div class="form-group">
                    <label for="address">Address</label>
                    <input type="text" id="address" placeholder="Will auto-fill or you can enter manually">
                </div>

                <!-- City Input -->
                <div class="form-group">
                    <label for="city">City</label>
                    <input type="text" id="city" placeholder="e.g., Pebble Beach">
                </div>

                <!-- State Input -->
                <div class="form-group">
                    <label for="state">State</label>
                    <input type="text" id="state" placeholder="e.g., California">
                </div>

                <!-- Country Input -->
                <div class="form-group">
                    <label for="country">Country</label>
                    <input type="text" id="country" placeholder="e.g., USA">
                </div>

                <!-- Course Website -->
                <div class="form-group">
                    <label for="website">Course Website</label>
                    <input type="text" id="website" placeholder="Will auto-fill or you can enter manually">
                </div>

                <!-- ============================================
                     WISH LIST FIELDS
                     Only shown when "Wish List" is selected
                     ============================================ -->
                <div id="wishlistFields">
                    <!-- Where You Heard About It (Optional) -->
                    <div class="form-group">
                        <label for="heardFrom">Where did you hear about it?</label>
                        <input type="text" id="heardFrom" placeholder="e.g., Friend, Magazine, YouTube">
                    </div>

                    <!-- Rating Selection - Your 3-tier system -->
                    <div class="form-group">
                        <label>Rating</label>
                        <div class="rating-options">
                            <!-- Option 1: Must Play -->
                            <label class="rating-option">
                                <input type="radio" name="rating" value="must">
                                <div class="rating-label">
                                    <div class="rating-title">üåü Must Play</div>
                                    <div class="rating-desc">Would make a special trip</div>
                                </div>
                            </label>
                            <!-- Option 2: Would Like to Play -->
                            <label class="rating-option">
                                <input type="radio" name="rating" value="would">
                                <div class="rating-label">
                                    <div class="rating-title">‚≠ê Would Like to Play</div>
                                    <div class="rating-desc">If convenient</div>
                                </div>
                            </label>
                            <!-- Option 3: Would Play if Nearby -->
                            <label class="rating-option">
                                <input type="radio" name="rating" value="nearby">
                                <div class="rating-label">
                                    <div class="rating-title">‚ú® Would Play if Nearby</div>
                                    <div class="rating-desc">If in the same city</div>
                                </div>
                            </label>
                        </div>
                    </div>

                    <!-- Notes Section (Optional) -->
                    <div class="form-group">
                        <label for="wishlistNotes">Notes</label>
                        <textarea id="wishlistNotes" placeholder="Any additional thoughts or details..."></textarea>
                    </div>
                </div>

                <!-- ============================================
                     PLAYED FIELDS
                     Only shown when "Played" is selected
                     ============================================ -->
                <div id="playedFields" style="display: none;">
                    <!-- Date Played (Required for played courses) -->
                    <div class="form-group">
                        <label for="datePlayed">Date *</label>
                        <input type="date" id="datePlayed">
                    </div>

                    <!-- 9 or 18 Holes -->
                    <div class="form-group">
                        <label>Holes Played</label>
                        <div class="rating-options">
                            <label class="rating-option">
                                <input type="radio" name="holes" value="9">
                                <div class="rating-label">
                                    <div class="rating-title">9 Holes</div>
                                </div>
                            </label>
                            <label class="rating-option">
                                <input type="radio" name="holes" value="18" checked>
                                <div class="rating-label">
                                    <div class="rating-title">18 Holes</div>
                                </div>
                            </label>
                        </div>
                    </div>

                    <!-- Score -->
                    <div class="form-group">
                        <label for="score">Score</label>
                        <input type="text" id="score" placeholder="e.g., 85, 92">
                    </div>

                    <!-- Who You Played With - Add one person at a time -->
                    <div class="form-group">
                        <label>People Played With</label>
                        <!-- List of added players (starts empty) -->
                        <div id="playersList" style="margin-bottom: 10px;"></div>
                        <!-- Input fields to add one person -->
                        <div id="playerInputArea" style="background: #f8f9fa; border-radius: 8px; padding: 12px; border: 2px solid #e0e0e0;">
                            <div style="margin-bottom: 8px;">
                                <div class="autocomplete-container">
                                    <input type="text" id="playerName" placeholder="Name *" style="margin-bottom: 8px;" autocomplete="off">
                                    <div class="autocomplete-dropdown" id="playerAutocompleteDropdown"></div>
                                </div>
                                <input type="text" id="playerCompany" placeholder="Company (optional)" style="margin-bottom: 8px;">
                                <input type="text" id="playerEmail" placeholder="Email (optional)">
                            </div>
                            <button type="button" id="btnAddPlayer" class="btn btn-primary" style="padding: 10px; font-size: 14px;">+ Add Person</button>
                        </div>
                    </div>

                    <!-- Notes for Played -->
                    <div class="form-group">
                        <label for="playedNotes">Notes</label>
                        <textarea id="playedNotes" placeholder="How was the experience? Any memorable moments?"></textarea>
                    </div>

                    <!-- Photos -->
                    <div class="form-group">
                        <label>Photos</label>
                        <!-- Preview area for added photos -->
                        <div id="photosPreview" style="display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 10px;"></div>
                        <!-- File input - on iPhone this opens Photos app, on PC opens file browser -->
                        <label class="btn btn-secondary" style="text-align: center; display: block; cursor: pointer; margin-top: 0;">
                            üì∑ Add Photos
                            <input type="file" id="photoInput" accept="image/*" multiple style="display: none;">
                        </label>
                        <div style="font-size: 12px; color: #999; margin-top: 6px;">You can add multiple photos. Photos are automatically compressed.</div>
                    </div>
                </div>

                <!-- Submit, Cancel, and Delete Buttons -->
                <button type="submit" id="btnSubmitCourse" class="btn btn-primary">Add Course</button>
                <button type="button" id="btnCancelAdd" class="btn btn-secondary">Cancel</button>
                <button type="button" id="btnDeleteFromForm" class="btn btn-delete" style="display: none; margin-top: 10px;">üóëÔ∏è Delete Course</button>
            </form>
        </div>

        <!-- ============================================
             WISH LIST VIEW
             Shows all courses you want to play
             ============================================ -->
        <div id="wishListContainer" class="course-list active">
            <div class="sort-controls" id="wishListSortControls" style="display:none;">
                <div class="sort-label">View:</div>
                <div class="sort-buttons">
                    <button class="sort-btn active" data-sort="alpha" data-list="wish">A‚ÄìZ</button>
                    <button class="sort-btn" data-sort="state" data-list="wish">üìç Location</button>
                    <button class="sort-btn" data-sort="rating" data-list="wish">‚≠ê Rating</button>
                </div>
            </div>
            <div id="wishList">
            </div>
        </div>

        <!-- ============================================
             PLAYED LIST VIEW
             Shows all courses you've played (can have duplicates)
             ============================================ -->
        <div id="playedListContainer" class="course-list">
            <div class="sort-controls" id="playedListSortControls" style="display:none;">
                <div class="sort-label">View:</div>
                <div class="sort-buttons">
                    <button class="sort-btn active" data-sort="alpha" data-list="played">A‚ÄìZ</button>
                    <button class="sort-btn" data-sort="state" data-list="played">üìç Location</button>
                    <button class="sort-btn" data-sort="score" data-list="played">üèåÔ∏è Score</button>
                </div>
            </div>
            <div id="playedList">
            </div>
        </div>

        <!-- ============================================
             COURSE DETAIL MODAL (POPUP)
             Hidden popup that shows when you click on a course
             Displays all details and has a delete button
             ============================================ -->
        <div id="courseModal" class="course-detail-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <!-- Course name will be inserted here by JavaScript -->
                    <h2 id="modalCourseName" style="color: #1e3c72; flex: 1;"></h2>
                    <!-- X button to close the popup -->
                    <button class="modal-close" id="btnCloseModal">&times;</button>
                </div>
                
                <!-- All course details will be inserted here by JavaScript -->
                <div id="modalContent">
                    <!-- Details will be inserted here -->
                </div>
                
                <!-- Buttons shown based on which list you're viewing -->
                <div id="modalButtons">
                    <!-- "Mark as Played" button (only for wish list courses) -->
                    <button id="btnMarkAsPlayed" class="btn btn-primary" style="display: none; margin-bottom: 10px;">‚úÖ Mark as Played</button>
                    <!-- Edit button -->
                    <button id="btnEditCourse" class="btn btn-primary" style="margin-top: 24px; margin-bottom: 10px;">‚úèÔ∏è Edit</button>
                    <!-- Delete button (red) -->
                    <button id="btnDeleteCourse" class="btn btn-delete">Delete Course</button>
                </div>
            </div>
        </div>
        </div><!-- end mainApp -->

        <!-- Full-size photo viewer (click a thumbnail to see it big) -->
        <div id="photoViewer" class="photo-viewer" onclick="this.classList.remove('active');">
            <img id="photoViewerImg" src="" alt="Photo">
        </div>
    </div>

    <!-- ============================================
         JAVASCRIPT CODE
         This is where all the app logic lives - making buttons work,
         saving data, showing/hiding things, etc.
         ============================================ -->
    <script>
        console.log('JavaScript is loading...');
        
        // ==========================================
        // FIREBASE CONFIGURATION & INITIALIZATION
        //
        // *** ONE-TIME SETUP REQUIRED ***
        // You need to enable Email/Password sign-in in Firebase.
        // Follow the step-by-step instructions below.
        //
        // Already done: Realtime Database + security rules
        // Still needed: Enable Email/Password auth (see instructions below)
        // ==========================================
        const firebaseConfig = {
            apiKey: "AIzaSyDifFA4lfZyuq83mZLisCPQLO2iISzrb8I",
            authDomain: "golf-tracker-abbf1.firebaseapp.com",
            databaseURL: "https://golf-tracker-abbf1-default-rtdb.firebaseio.com",
            projectId: "golf-tracker-abbf1",
            storageBucket: "golf-tracker-abbf1.firebasestorage.app",
            messagingSenderId: "347480815517",
            appId: "1:347480815517:web:821e0055e59fe8f6cb6174",
            measurementId: "G-M1Q2HGQWG2"
        };
        
        // Initialize Firebase
        let database;
        let currentUserId = null;
        let useCloudSync = false;
        let firebaseListeners = [];  // Track listeners so we can detach on logout
        
        try {
            firebase.initializeApp(firebaseConfig);
            database = firebase.database();
            console.log('Firebase initialized');
        } catch (error) {
            console.error('Firebase initialization error:', error);
        }

        // ==========================================
        // AUTH STATE LISTENER
        // This is the HEART of the login system.
        // Firebase calls this automatically whenever:
        //   - The page first loads (checks if already logged in)
        //   - A user logs in
        //   - A user logs out
        // It controls which screen is shown.
        // ==========================================
        firebase.auth().onAuthStateChanged(function(user) {
            document.getElementById('loadingScreen').style.display = 'none';
            
            if (user) {
                // USER IS LOGGED IN
                currentUserId = user.uid;
                useCloudSync = true;
                console.log('User signed in:', user.email, 'UID:', user.uid);
                
                document.getElementById('userBarEmail').textContent = 
                    'üë§ ' + (user.displayName || user.email);
                
                document.getElementById('authScreen').style.display = 'none';
                document.getElementById('mainApp').style.display = 'block';
                document.getElementById('userBarArea').style.display = 'flex';
                
                loadDataFromCloud();
                displayRandomGolfQuote();
            } else {
                // USER IS NOT LOGGED IN
                currentUserId = null;
                useCloudSync = false;
                console.log('No user signed in');
                
                document.getElementById('authScreen').style.display = 'block';
                document.getElementById('mainApp').style.display = 'none';
                document.getElementById('userBarArea').style.display = 'none';
                
                wishlistCourses = [];
                playedCourses = [];
                savedPlayers = [];
                renderWishList();
                renderPlayedList();
                
                // Detach Firebase listeners
                firebaseListeners.forEach(function(ref) { ref.off(); });
                firebaseListeners = [];
            }
        });

        // ==========================================
        // GOLF QUOTES
        // A random quote displays each time you load the app
        // ==========================================
        const golfQuotes = [
            { text: "The most important shot in golf is the next one.", author: "Ben Hogan" },
            { text: "Golf is deceptively simple and endlessly complicated.", author: "Arnold Palmer" },
            { text: "Success in golf depends less on strength of body than upon strength of mind and character.", author: "Arnold Palmer" },
            { text: "Golf is the closest game to the game we call life.", author: "Bobby Jones" },
            { text: "I never learned anything from a match that I won.", author: "Bobby Jones" },
            { text: "The secret of golf is to turn three shots into two.", author: "Bobby Jones" },
            { text: "Concentrate on hitting the green. The hole will come to you.", author: "Cary Middlecoff" },
            { text: "I know I am getting better at golf because I am hitting fewer spectators.", author: "Gerald Ford" },
            { text: "They say golf is like life, but don't believe them. Golf is more complicated than that.", author: "Gardner Dickinson" },
            { text: "Golf is a game in which you yell fore, shoot six, and write down five.", author: "Paul Harvey" },
            { text: "The only thing a golfer needs is more daylight.", author: "Ben Hogan" },
            { text: "I play in the low 80s. If it's any hotter than that, I won't play.", author: "Joe E. Lewis" },
            { text: "Golf is a game whose aim is to hit a very small ball into an even smaller hole, with weapons singularly ill-designed for the purpose.", author: "Winston Churchill" },
            { text: "Give me golf clubs, fresh air, and a beautiful partner, and you can keep the clubs and the fresh air.", author: "Jack Benny" },
            { text: "If you are caught on a golf course during a storm and are afraid of lightning, hold up a 1-iron. Not even God can hit a 1-iron.", author: "Lee Trevino" },
            { text: "I'm hitting the woods just great, but I'm having a terrible time getting out of them.", author: "Harry Toscano" },
            { text: "Golf is a puzzle without an answer.", author: "Gary Player" },
            { text: "The more I practice, the luckier I get.", author: "Gary Player" },
            { text: "Eighteen holes of match play will teach you more about your foe than 18 years of dealing with him across a desk.", author: "Grantland Rice" },
            { text: "A bad day of golf is better than a good day of work.", author: "Unknown" },
            { text: "Golf is the only sport where the most feared opponent is you.", author: "Unknown" },
            { text: "Every golfer has a little voice inside their head. Mine usually says the wrong thing.", author: "Lee Trevino" },
            { text: "One of the most fascinating things about golf is how it reflects the cycle of life.", author: "Tom Watson" },
            { text: "Swing easy, hit hard.", author: "Julius Boros" },
            { text: "It's good sportsmanship to not pick up lost golf balls while they are still rolling.", author: "Mark Twain" },
            { text: "Golf is about how well you accept, adjust, and score with your misses much more so than it is about your perfect shots.", author: "Tommy Armour" },
            { text: "The only way to enjoy golf is to be a good sport about losing.", author: "Unknown" },
            { text: "Don't play too much golf. Two rounds a day are plenty.", author: "Harry Vardon" },
            { text: "Half of golf is fun; the other half is putting.", author: "Peter Dobereiner" },
            { text: "It took me seventeen years to get 3,000 hits in baseball. It took one afternoon on the golf course.", author: "Hank Aaron" },
            { text: "Golf combines two favorite American pastimes: taking long walks and hitting things with a stick.", author: "P.J. O'Rourke" },
            { text: "You can make a lot of money in this game. Just ask my ex-wives. Both of them are so rich that neither of their husbands work.", author: "Lee Trevino" },
            { text: "May thy ball lie in green pastures, and not in still waters.", author: "Ben Hogan" },
            { text: "The ardent golfer would play Mount Everest if somebody would put a flag stick on top.", author: "Pete Dye" },
            { text: "There is no similarity between golf and putting; they are two different games, one played in the air, and the other on the ground.", author: "Ben Hogan" },
            { text: "You don't know what pressure is until you play for five bucks with only two in your pocket.", author: "Lee Trevino" },
            { text: "Golf is a game that is played on a five-inch course ‚Äî the distance between your ears.", author: "Bobby Jones" },
            { text: "The golf swing is like a suitcase into which we are trying to pack one too many things.", author: "John Updike" },
            { text: "I have a tip that can take five strokes off anyone's golf game: it's called an eraser.", author: "Arnold Palmer" },
            { text: "After all these years, it's still embarrassing for me to play on the American golf tour. Like the time I asked my caddie for a sand wedge and he came back ten minutes later with a ham on rye.", author: "Chi-Chi Rodriguez" }
        ];

        function displayRandomGolfQuote() {
            const quote = golfQuotes[Math.floor(Math.random() * golfQuotes.length)];
            document.getElementById('golfQuote').innerHTML = 
                '"' + quote.text + '"' +
                '<div class="golf-quote-author">‚Äî ' + quote.author + '</div>';
        }

        // ==========================================
        // AUTH SCREEN NAVIGATION
        // ==========================================
        document.getElementById('linkShowSignup').addEventListener('click', function() {
            document.getElementById('loginView').style.display = 'none';
            document.getElementById('signupView').style.display = 'block';
            document.getElementById('resetView').style.display = 'none';
            clearAuthErrors();
        });
        document.getElementById('linkShowLogin').addEventListener('click', function() {
            document.getElementById('loginView').style.display = 'block';
            document.getElementById('signupView').style.display = 'none';
            document.getElementById('resetView').style.display = 'none';
            clearAuthErrors();
        });
        document.getElementById('linkForgotPassword').addEventListener('click', function() {
            document.getElementById('loginView').style.display = 'none';
            document.getElementById('signupView').style.display = 'none';
            document.getElementById('resetView').style.display = 'block';
            document.getElementById('resetEmail').value = document.getElementById('loginEmail').value;
            clearAuthErrors();
        });
        document.getElementById('linkBackToLogin').addEventListener('click', function() {
            document.getElementById('loginView').style.display = 'block';
            document.getElementById('signupView').style.display = 'none';
            document.getElementById('resetView').style.display = 'none';
            clearAuthErrors();
        });

        function clearAuthErrors() {
            ['loginError','signupError','resetError','resetSuccess'].forEach(function(id) {
                document.getElementById(id).style.display = 'none';
            });
        }
        function showAuthError(id, msg) {
            var el = document.getElementById(id);
            el.textContent = msg;
            el.style.display = 'block';
        }
        function friendlyAuthError(error) {
            switch (error.code) {
                case 'auth/user-not-found': return 'No account found with this email. Would you like to sign up?';
                case 'auth/wrong-password':
                case 'auth/invalid-credential': return 'Incorrect password. Please try again or reset your password.';
                case 'auth/email-already-in-use': return 'An account with this email already exists. Try signing in instead.';
                case 'auth/weak-password': return 'Password must be at least 6 characters.';
                case 'auth/invalid-email': return 'Please enter a valid email address.';
                case 'auth/too-many-requests': return 'Too many attempts. Please wait a moment and try again.';
                case 'auth/network-request-failed': return 'Network error. Please check your internet connection.';
                default: return error.message || 'Something went wrong. Please try again.';
            }
        }

        // LOGIN
        document.getElementById('btnLogin').addEventListener('click', async function() {
            var email = document.getElementById('loginEmail').value.trim();
            var password = document.getElementById('loginPassword').value;
            if (!email || !password) { showAuthError('loginError', 'Please enter your email and password.'); return; }
            this.disabled = true; this.textContent = 'Signing in...'; clearAuthErrors();
            try { await firebase.auth().signInWithEmailAndPassword(email, password); }
            catch (error) { showAuthError('loginError', friendlyAuthError(error)); }
            finally { this.disabled = false; this.textContent = 'Sign In'; }
        });
        document.getElementById('loginPassword').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') document.getElementById('btnLogin').click();
        });
        document.getElementById('loginEmail').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') document.getElementById('loginPassword').focus();
        });

        // SIGN UP
        document.getElementById('btnSignup').addEventListener('click', async function() {
            var name = document.getElementById('signupName').value.trim();
            var email = document.getElementById('signupEmail').value.trim();
            var password = document.getElementById('signupPassword').value;
            var confirm = document.getElementById('signupConfirm').value;
            if (!email || !password) { showAuthError('signupError', 'Please enter your email and password.'); return; }
            if (password !== confirm) { showAuthError('signupError', 'Passwords do not match.'); return; }
            if (password.length < 6) { showAuthError('signupError', 'Password must be at least 6 characters.'); return; }
            this.disabled = true; this.textContent = 'Creating account...'; clearAuthErrors();
            try {
                var cred = await firebase.auth().createUserWithEmailAndPassword(email, password);
                if (name) {
                    await cred.user.updateProfile({ displayName: name });
                    document.getElementById('userBarEmail').textContent = 'üë§ ' + name;
                }
            } catch (error) { showAuthError('signupError', friendlyAuthError(error)); }
            finally { this.disabled = false; this.textContent = 'Create Account'; }
        });
        document.getElementById('signupConfirm').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') document.getElementById('btnSignup').click();
        });

        // PASSWORD RESET
        document.getElementById('btnReset').addEventListener('click', async function() {
            var email = document.getElementById('resetEmail').value.trim();
            if (!email) { showAuthError('resetError', 'Please enter your email address.'); return; }
            this.disabled = true; this.textContent = 'Sending...'; clearAuthErrors();
            try {
                await firebase.auth().sendPasswordResetEmail(email);
                var el = document.getElementById('resetSuccess');
                el.textContent = 'Password reset email sent! Check your inbox (and spam folder).';
                el.style.display = 'block';
            } catch (error) { showAuthError('resetError', friendlyAuthError(error)); }
            finally { this.disabled = false; this.textContent = 'Send Reset Link'; }
        });

        // SIGN OUT
        document.getElementById('btnLogout').addEventListener('click', function() {
            firebase.auth().signOut().catch(function(err) { console.error('Sign out error:', err); });
        });
        
        // ==========================================
        // DATA STORAGE VARIABLES
        // Two separate arrays: one for wish list, one for played courses
        // ==========================================
        let wishlistCourses = [];  // Courses you want to play
        let playedCourses = [];    // Courses you've played (can have duplicates)
        let savedPlayers = [];     // Directory of people you've played with (synced to cloud)
        let currentCourseId = null;  // Keeps track of which course popup is open
        let currentListType = null;  // Tracks whether we're viewing 'wishlist' or 'played'
        let editingId = null;        // ID of course/round being edited (null = adding new)
        let editingType = null;      // 'wishlist' or 'played' when editing

        // localStorage fallback removed - now using Firebase email/password auth only

        // ==========================================
        // LOAD DATA FROM FIREBASE CLOUD
        // Syncs data across all your devices
        // ==========================================
        function loadDataFromCloud() {
            if (!useCloudSync || !currentUserId || !database) return;
            
            var userRef = database.ref('users/' + currentUserId);
            
            var wishlistRef = userRef.child('wishlist');
            wishlistRef.on('value', function(snapshot) {
                var data = snapshot.val();
                wishlistCourses = data ? Object.values(data) : [];
                renderWishList();
            });
            firebaseListeners.push(wishlistRef);
            
            var playedRef = userRef.child('played');
            playedRef.on('value', function(snapshot) {
                var data = snapshot.val();
                playedCourses = data ? Object.values(data) : [];
                renderPlayedList();
            });
            firebaseListeners.push(playedRef);
            
            // Load saved players directory
            var playersRef = userRef.child('savedPlayers');
            playersRef.on('value', function(snapshot) {
                var data = snapshot.val();
                savedPlayers = data ? Object.values(data) : [];
            });
            firebaseListeners.push(playersRef);
        }

        // ==========================================
        // SAVE DATA TO CLOUD (and Local Storage as backup)
        // Whenever you add/delete a course, save to cloud
        // ==========================================
        function saveData() {
            if (useCloudSync && currentUserId && database) {
                const userRef = database.ref('users/' + currentUserId);
                
                // Convert arrays to objects with IDs as keys for Firebase
                const wishlistObj = {};
                wishlistCourses.forEach(course => {
                    wishlistObj[course.id] = course;
                });
                
                const playedObj = {};
                playedCourses.forEach(round => {
                    playedObj[round.id] = round;
                });
                
                // Save to cloud
                userRef.child('wishlist').set(wishlistObj)
                    .catch(error => console.error('Error saving wishlist to cloud:', error));
                    
                userRef.child('played').set(playedObj)
                    .catch(error => console.error('Error saving played to cloud:', error));
                
                // Save players directory
                const playersObj = {};
                savedPlayers.forEach(function(player) {
                    // Use a sanitized version of the name as the key
                    const key = player.name.toLowerCase().replace(/[^a-z0-9]/g, '_');
                    playersObj[key] = player;
                });
                userRef.child('savedPlayers').set(playersObj)
                    .catch(error => console.error('Error saving players to cloud:', error));
            }
        }

        // ==========================================
        // AUTOCOMPLETE FUNCTIONALITY
        // Searches for golf courses as you type
        // ==========================================
        let autocompleteTimeout = null;
        const courseNameInput = document.getElementById('courseName');
        const autocompleteDropdown = document.getElementById('autocompleteDropdown');

        // ==========================================
        // COMPREHENSIVE LOCAL GOLF COURSE DATABASE
        // Provides instant results without waiting for API
        // ==========================================
        const localCourseDatabase = [
            { name: 'Robert Trent Jones Golf Trail', location: 'Birmingham, Alabama' },
            { name: 'Shoal Creek', location: 'Shoal Creek, Alabama' },
            { name: 'Ross Bridge Golf Club', location: 'Hoover, Alabama' },
            { name: 'Capitol Hill Golf Club', location: 'Prattville, Alabama' },
            { name: 'FarmLinks Golf Club', location: 'Sylacauga, Alabama' },
            { name: 'Ol Colony Golf Complex', location: 'Tuscaloosa, Alabama' },
            { name: 'Kiva Dunes Golf Course', location: 'Gulf Shores, Alabama' },
            { name: 'Grand National Golf Course', location: 'Opelika, Alabama' },
            { name: 'Lakewood Golf Club', location: 'Point Clear, Alabama' },
            { name: 'Oxmoor Valley Golf Course', location: 'Birmingham, Alabama' },
            { name: 'The Shoals Golf Course', location: 'Muscle Shoals, Alabama' },
            { name: 'Silver Lakes Golf Course', location: 'Glencoe, Alabama' },
            { name: 'Moose Run Golf Course', location: 'Anchorage, Alaska' },
            { name: 'Settlers Bay Golf Course', location: 'Wasilla, Alaska' },
            { name: 'Palmer Golf Course', location: 'Palmer, Alaska' },
            { name: 'Eagleglen Golf Course', location: 'Anchorage, Alaska' },
            { name: 'Bear Valley Golf Course', location: 'Anchorage, Alaska' },
            { name: 'We-Ko-Pa Golf Club', location: 'Scottsdale, Arizona' },
            { name: 'Troon North Golf Club', location: 'Scottsdale, Arizona' },
            { name: 'TPC Scottsdale', location: 'Scottsdale, Arizona' },
            { name: 'Grayhawk Golf Club', location: 'Scottsdale, Arizona' },
            { name: 'Quintero Golf Club', location: 'Peoria, Arizona' },
            { name: 'Whisper Rock Golf Club', location: 'Scottsdale, Arizona' },
            { name: 'Desert Mountain Club', location: 'Scottsdale, Arizona' },
            { name: 'Estancia Club', location: 'Scottsdale, Arizona' },
            { name: 'Southern Dunes Golf Club', location: 'Maricopa, Arizona' },
            { name: 'Wickenburg Ranch Golf Club', location: 'Wickenburg, Arizona' },
            { name: 'Talking Stick Golf Club', location: 'Scottsdale, Arizona' },
            { name: 'Desert Highlands Golf Club', location: 'Scottsdale, Arizona' },
            { name: 'Boulders Golf Club', location: 'Scottsdale, Arizona' },
            { name: 'Superstition Mountain Golf Club', location: 'Gold Canyon, Arizona' },
            { name: 'Forest Highlands Golf Club', location: 'Flagstaff, Arizona' },
            { name: 'Arizona Biltmore Golf Club', location: 'Phoenix, Arizona' },
            { name: 'Ak-Chin Southern Dunes', location: 'Maricopa, Arizona' },
            { name: 'Verrado Golf Club', location: 'Buckeye, Arizona' },
            { name: 'SunRidge Canyon Golf Club', location: 'Fountain Hills, Arizona' },
            { name: 'Gold Canyon Golf Resort', location: 'Gold Canyon, Arizona' },
            { name: 'Alotian Club', location: 'Roland, Arkansas' },
            { name: 'Big Cedar Lodge Golf', location: 'Ridgedale, Arkansas' },
            { name: 'Stonebridge Meadows Golf Club', location: 'Fayetteville, Arkansas' },
            { name: 'Mystic Creek Golf Club', location: 'El Dorado, Arkansas' },
            { name: 'Mountain Ranch Golf Club', location: 'Fairfield Bay, Arkansas' },
            { name: 'Hot Springs Country Club', location: 'Hot Springs, Arkansas' },
            { name: 'Pebble Beach Golf Links', location: 'Pebble Beach, California' },
            { name: 'Cypress Point Club', location: 'Pebble Beach, California' },
            { name: 'Riviera Country Club', location: 'Pacific Palisades, California' },
            { name: 'Los Angeles Country Club', location: 'Los Angeles, California' },
            { name: 'Olympic Club', location: 'San Francisco, California' },
            { name: 'Torrey Pines Golf Course', location: 'La Jolla, California' },
            { name: 'Spyglass Hill Golf Course', location: 'Pebble Beach, California' },
            { name: 'The Links at Spanish Bay', location: 'Pebble Beach, California' },
            { name: 'Pasatiempo Golf Club', location: 'Santa Cruz, California' },
            { name: 'Pelican Hill Golf Club', location: 'Newport Coast, California' },
            { name: 'San Francisco Golf Club', location: 'San Francisco, California' },
            { name: 'The Valley Club of Montecito', location: 'Santa Barbara, California' },
            { name: 'Harding Park Golf Course', location: 'San Francisco, California' },
            { name: 'Poppy Hills Golf Course', location: 'Pebble Beach, California' },
            { name: 'CordeValle Golf Club', location: 'San Martin, California' },
            { name: 'Monterey Peninsula Country Club', location: 'Pebble Beach, California' },
            { name: 'The Preserve Golf Club', location: 'Carmel, California' },
            { name: 'Tehama Golf Club', location: 'Carmel, California' },
            { name: 'Sherwood Country Club', location: 'Thousand Oaks, California' },
            { name: 'Trump National Golf Club Los Angeles', location: 'Rancho Palos Verdes, California' },
            { name: 'Bel-Air Country Club', location: 'Los Angeles, California' },
            { name: 'The Vintage Club', location: 'Indian Wells, California' },
            { name: 'Shady Canyon Golf Club', location: 'Irvine, California' },
            { name: 'Big Canyon Country Club', location: 'Newport Beach, California' },
            { name: 'PGA West', location: 'La Quinta, California' },
            { name: 'La Quinta Resort & Club', location: 'La Quinta, California' },
            { name: 'Indian Wells Golf Resort', location: 'Indian Wells, California' },
            { name: 'Maderas Golf Club', location: 'Poway, California' },
            { name: 'Aviara Golf Club', location: 'Carlsbad, California' },
            { name: 'Sandpiper Golf Club', location: 'Goleta, California' },
            { name: 'Cherry Hills Country Club', location: 'Cherry Hills Village, Colorado' },
            { name: 'Castle Pines Golf Club', location: 'Castle Rock, Colorado' },
            { name: 'Colorado Golf Club', location: 'Parker, Colorado' },
            { name: 'The Broadmoor Golf Club', location: 'Colorado Springs, Colorado' },
            { name: 'Ballyneal Golf Club', location: 'Holyoke, Colorado' },
            { name: 'Red Sky Golf Club', location: 'Vail, Colorado' },
            { name: 'Sanctuary Golf Course', location: 'Sedalia, Colorado' },
            { name: 'Bear Creek Golf Club', location: 'Denver, Colorado' },
            { name: 'Arrowhead Golf Club', location: 'Littleton, Colorado' },
            { name: 'The Club at Ravenna', location: 'Littleton, Colorado' },
            { name: 'Fossil Trace Golf Club', location: 'Golden, Colorado' },
            { name: 'TPC Colorado', location: 'Berthoud, Colorado' },
            { name: 'Yale Golf Course', location: 'New Haven, Connecticut' },
            { name: 'The Stanwich Club', location: 'Greenwich, Connecticut' },
            { name: 'Ridgewood Country Club', location: 'Danbury, Connecticut' },
            { name: 'TPC River Highlands', location: 'Cromwell, Connecticut' },
            { name: 'Lake of Isles Golf Course', location: 'North Stonington, Connecticut' },
            { name: 'Shorehaven Golf Club', location: 'Norwalk, Connecticut' },
            { name: 'Country Club of Fairfield', location: 'Fairfield, Connecticut' },
            { name: 'Hartford Golf Club', location: 'West Hartford, Connecticut' },
            { name: 'Wethersfield Country Club', location: 'Wethersfield, Connecticut' },
            { name: 'New Haven Country Club', location: 'Hamden, Connecticut' },
            { name: 'Wilmington Country Club', location: 'Wilmington, Delaware' },
            { name: 'Fieldstone Golf Club', location: 'Greenville, Delaware' },
            { name: 'Baywood Greens Golf Course', location: 'Long Neck, Delaware' },
            { name: 'The Salt Pond Golf Club', location: 'Bethany Beach, Delaware' },
            { name: 'Royal Manchester Golf Links', location: 'Bear, Delaware' },
            { name: 'TPC Sawgrass', location: 'Ponte Vedra Beach, Florida' },
            { name: 'Seminole Golf Club', location: 'Juno Beach, Florida' },
            { name: 'Streamsong Resort', location: 'Streamsong, Florida' },
            { name: 'Bay Hill Club & Lodge', location: 'Orlando, Florida' },
            { name: 'PGA National Resort', location: 'Palm Beach Gardens, Florida' },
            { name: 'Trump International Golf Club', location: 'West Palm Beach, Florida' },
            { name: 'Trump National Doral', location: 'Miami, Florida' },
            { name: 'Calusa Pines Golf Club', location: 'Naples, Florida' },
            { name: 'Old Marsh Golf Club', location: 'Palm Beach Gardens, Florida' },
            { name: 'Medalist Golf Club', location: 'Hobe Sound, Florida' },
            { name: 'The Bear\'s Club', location: 'Jupiter, Florida' },
            { name: 'Pine Tree Golf Club', location: 'Boynton Beach, Florida' },
            { name: 'Loxahatchee Club', location: 'Jupiter, Florida' },
            { name: 'McArthur Golf Club', location: 'Hobe Sound, Florida' },
            { name: 'Jupiter Hills Club', location: 'Tequesta, Florida' },
            { name: 'The Breakers', location: 'Palm Beach, Florida' },
            { name: 'Innisbrook Resort', location: 'Palm Harbor, Florida' },
            { name: 'World Golf Village', location: 'St. Augustine, Florida' },
            { name: 'Boca Raton Resort & Club', location: 'Boca Raton, Florida' },
            { name: 'Cabot Citrus Farms', location: 'Brooksville, Florida' },
            { name: 'Black Diamond Ranch', location: 'Lecanto, Florida' },
            { name: 'Sawgrass Marriott Golf Resort', location: 'Ponte Vedra Beach, Florida' },
            { name: 'Doral Golf Resort', location: 'Miami, Florida' },
            { name: 'Walt Disney World Golf', location: 'Orlando, Florida' },
            { name: 'TPC Tampa Bay', location: 'Lutz, Florida' },
            { name: 'Augusta National Golf Club', location: 'Augusta, Georgia' },
            { name: 'East Lake Golf Club', location: 'Atlanta, Georgia' },
            { name: 'Peachtree Golf Club', location: 'Atlanta, Georgia' },
            { name: 'Sea Island Golf Club', location: 'St. Simons Island, Georgia' },
            { name: 'Reynolds Lake Oconee', location: 'Greensboro, Georgia' },
            { name: 'Atlanta Athletic Club', location: 'Johns Creek, Georgia' },
            { name: 'Capital City Club', location: 'Atlanta, Georgia' },
            { name: 'Ansley Golf Club', location: 'Atlanta, Georgia' },
            { name: 'Bobby Jones Golf Course', location: 'Atlanta, Georgia' },
            { name: 'TPC Sugarloaf', location: 'Duluth, Georgia' },
            { name: 'The Manor Golf Club', location: 'Milton, Georgia' },
            { name: 'Hawks Ridge Golf Club', location: 'Ball Ground, Georgia' },
            { name: 'Ch√¢teau √âlan Golf Club', location: 'Braselton, Georgia' },
            { name: 'The Landings Club', location: 'Savannah, Georgia' },
            { name: 'McLemore Resort', location: 'Rising Fawn, Georgia' },
            { name: 'The Keep at McLemore Resort', location: 'Rising Fawn, Georgia' },
            { name: 'The Highlands at McLemore Resort', location: 'Rising Fawn, Georgia' },
            { name: 'Kapalua Golf Club', location: 'Lahaina, Hawaii' },
            { name: 'Mauna Kea Golf Course', location: 'Kohala Coast, Hawaii' },
            { name: 'Mauna Lani Golf Course', location: 'Kohala Coast, Hawaii' },
            { name: 'Princeville Golf Club', location: 'Princeville, Hawaii' },
            { name: 'Turtle Bay Resort Golf', location: 'Kahuku, Hawaii' },
            { name: 'Ko Olina Golf Club', location: 'Kapolei, Hawaii' },
            { name: 'Wailea Golf Club', location: 'Wailea, Hawaii' },
            { name: 'Hualalai Golf Club', location: 'Kailua-Kona, Hawaii' },
            { name: 'Nanea Golf Club', location: 'Kailua-Kona, Hawaii' },
            { name: 'Kukuiula Golf Course', location: 'Poipu, Hawaii' },
            { name: 'Circling Raven Golf Club', location: 'Worley, Idaho' },
            { name: 'Coeur d\'Alene Resort Golf Course', location: 'Coeur d\'Alene, Idaho' },
            { name: 'BanBury Golf Course', location: 'Eagle, Idaho' },
            { name: 'Osprey Meadows Golf Course', location: 'Donnelly, Idaho' },
            { name: 'Shadow Valley Golf Course', location: 'Boise, Idaho' },
            { name: 'Chicago Golf Club', location: 'Wheaton, Illinois' },
            { name: 'Medinah Country Club', location: 'Medinah, Illinois' },
            { name: 'Olympia Fields Country Club', location: 'Olympia Fields, Illinois' },
            { name: 'Cog Hill Golf & Country Club', location: 'Lemont, Illinois' },
            { name: 'Shoreacres', location: 'Lake Bluff, Illinois' },
            { name: 'Bob O\'Link Golf Club', location: 'Highland Park, Illinois' },
            { name: 'Beverly Country Club', location: 'Chicago, Illinois' },
            { name: 'Rich Harvest Farms', location: 'Sugar Grove, Illinois' },
            { name: 'Conway Farms Golf Club', location: 'Lake Forest, Illinois' },
            { name: 'Kemper Lakes Golf Club', location: 'Kildeer, Illinois' },
            { name: 'The Glen Club', location: 'Glenview, Illinois' },
            { name: 'Cantigny Golf', location: 'Wheaton, Illinois' },
            { name: 'Ravinia Green Country Club', location: 'Riverwoods, Illinois' },
            { name: 'Crooked Stick Golf Club', location: 'Carmel, Indiana' },
            { name: 'Pete Dye Golf Club', location: 'Bridgeport, Indiana' },
            { name: 'French Lick Resort', location: 'French Lick, Indiana' },
            { name: 'Victoria National Golf Club', location: 'Newburgh, Indiana' },
            { name: 'Brickyard Crossing Golf Course', location: 'Indianapolis, Indiana' },
            { name: 'Wolf Run Golf Club', location: 'Zionsville, Indiana' },
            { name: 'The Fort Golf Course', location: 'Indianapolis, Indiana' },
            { name: 'Wakonda Club', location: 'Des Moines, Iowa' },
            { name: 'Spirit Hollow Golf Course', location: 'Burlington, Iowa' },
            { name: 'Harvester Golf Club', location: 'Rhodes, Iowa' },
            { name: 'Amana Colonies Golf Course', location: 'Amana, Iowa' },
            { name: 'Blue Top Ridge', location: 'Riverside, Iowa' },
            { name: 'Tournament Club of Iowa', location: 'Polk City, Iowa' },
            { name: 'Prairie Dunes Country Club', location: 'Hutchinson, Kansas' },
            { name: 'Colbert Hills Golf Course', location: 'Manhattan, Kansas' },
            { name: 'Flint Hills National Golf Club', location: 'Andover, Kansas' },
            { name: 'Sand Creek Station Golf Club', location: 'Newton, Kansas' },
            { name: 'Firekeeper Golf Course', location: 'Mayetta, Kansas' },
            { name: 'Valhalla Golf Club', location: 'Louisville, Kentucky' },
            { name: 'Keene Trace Golf Club', location: 'Nicholasville, Kentucky' },
            { name: 'Persimmon Ridge Golf Club', location: 'Louisville, Kentucky' },
            { name: 'Kearney Hill Golf Links', location: 'Lexington, Kentucky' },
            { name: 'Olde Stone Country Club', location: 'Bowling Green, Kentucky' },
            { name: 'TPC Louisiana', location: 'Avondale, Louisiana' },
            { name: 'English Turn Golf & Country Club', location: 'New Orleans, Louisiana' },
            { name: 'Carter Plantation Golf Course', location: 'Springfield, Louisiana' },
            { name: 'The Bluffs on Thompson Creek', location: 'St. Francisville, Louisiana' },
            { name: 'Money Hill Golf Club', location: 'Abita Springs, Louisiana' },
            { name: 'Belgrade Lakes Golf Club', location: 'Belgrade Lakes, Maine' },
            { name: 'Sugarloaf Golf Club', location: 'Carrabassett Valley, Maine' },
            { name: 'Sunday River Golf Club', location: 'Bethel, Maine' },
            { name: 'Samoset Resort Golf Club', location: 'Rockport, Maine' },
            { name: 'Penobscot Valley Country Club', location: 'Orono, Maine' },
            { name: 'Kebo Valley Golf Club', location: 'Bar Harbor, Maine' },
            { name: 'Congressional Country Club', location: 'Bethesda, Maryland' },
            { name: 'Caves Valley Golf Club', location: 'Owings Mills, Maryland' },
            { name: 'Baltimore Country Club', location: 'Lutherville-Timonium, Maryland' },
            { name: 'Bulle Rock Golf Course', location: 'Havre de Grace, Maryland' },
            { name: 'Whiskey Creek Golf Club', location: 'Ijamsville, Maryland' },
            { name: 'Renditions Golf Course', location: 'Davidsonville, Maryland' },
            { name: 'Woodholme Country Club', location: 'Pikesville, Maryland' },
            { name: 'The Country Club', location: 'Brookline, Massachusetts' },
            { name: 'Salem Country Club', location: 'Peabody, Massachusetts' },
            { name: 'Myopia Hunt Club', location: 'South Hamilton, Massachusetts' },
            { name: 'Essex County Club', location: 'Manchester-by-the-Sea, Massachusetts' },
            { name: 'Eastward Ho! Country Club', location: 'Chatham, Massachusetts' },
            { name: 'Kittansett Club', location: 'Marion, Massachusetts' },
            { name: 'Boston Golf Club', location: 'Hingham, Massachusetts' },
            { name: 'TPC Boston', location: 'Norton, Massachusetts' },
            { name: 'Pinehills Golf Club', location: 'Plymouth, Massachusetts' },
            { name: 'Granite Links Golf Club', location: 'Quincy, Massachusetts' },
            { name: 'Crystal Downs Country Club', location: 'Frankfort, Michigan' },
            { name: 'Oakland Hills Country Club', location: 'Bloomfield Hills, Michigan' },
            { name: 'Arcadia Bluffs Golf Club', location: 'Arcadia, Michigan' },
            { name: 'Forest Dunes Golf Club', location: 'Roscommon, Michigan' },
            { name: 'Kingsley Club', location: 'Kingsley, Michigan' },
            { name: 'Bay Harbor Golf Club', location: 'Bay Harbor, Michigan' },
            { name: 'Shanty Creek Resort', location: 'Bellaire, Michigan' },
            { name: 'Treetops Resort', location: 'Gaylord, Michigan' },
            { name: 'Boyne Highlands Resort', location: 'Harbor Springs, Michigan' },
            { name: 'The Wolverine Golf Club', location: 'Mackinaw City, Michigan' },
            { name: 'Hazeltine National Golf Club', location: 'Chaska, Minnesota' },
            { name: 'Interlachen Country Club', location: 'Edina, Minnesota' },
            { name: 'Windsong Farm Golf Club', location: 'Independence, Minnesota' },
            { name: 'The Wilds Golf Club', location: 'Prior Lake, Minnesota' },
            { name: 'Giants Ridge Golf Resort', location: 'Biwabik, Minnesota' },
            { name: 'Spring Hill Golf Club', location: 'Wayzata, Minnesota' },
            { name: 'Rush Creek Golf Club', location: 'Maple Grove, Minnesota' },
            { name: 'Legends Club', location: 'Prior Lake, Minnesota' },
            { name: 'Old Waverly Golf Club', location: 'West Point, Mississippi' },
            { name: 'Fallen Oak Golf Course', location: 'Biloxi, Mississippi' },
            { name: 'Dancing Rabbit Golf Club', location: 'Philadelphia, Mississippi' },
            { name: 'Annandale Golf Club', location: 'Madison, Mississippi' },
            { name: 'The Oaks Golf Club', location: 'Pass Christian, Mississippi' },
            { name: 'Bellerive Country Club', location: 'St. Louis, Missouri' },
            { name: 'Old Warson Country Club', location: 'Ladue, Missouri' },
            { name: 'St. Louis Country Club', location: 'Ladue, Missouri' },
            { name: 'Top of the Rock Golf Course', location: 'Ridgedale, Missouri' },
            { name: 'Payne\'s Valley Golf Course', location: 'Hollister, Missouri' },
            { name: 'The Club at Porto Cima', location: 'Sunrise Beach, Missouri' },
            { name: 'Stock Farm Club', location: 'Hamilton, Montana' },
            { name: 'Yellowstone Club', location: 'Big Sky, Montana' },
            { name: 'Old Works Golf Course', location: 'Anaconda, Montana' },
            { name: 'Whitefish Lake Golf Club', location: 'Whitefish, Montana' },
            { name: 'Wilderness Club', location: 'Eureka, Montana' },
            { name: 'Iron Horse Golf Club', location: 'Whitefish, Montana' },
            { name: 'Sand Hills Golf Club', location: 'Mullen, Nebraska' },
            { name: 'Dismal River Club', location: 'Mullen, Nebraska' },
            { name: 'The Prairie Club', location: 'Valentine, Nebraska' },
            { name: 'Firethorn Golf Club', location: 'Lincoln, Nebraska' },
            { name: 'Champions Run', location: 'Omaha, Nebraska' },
            { name: 'Indian Creek Golf Course', location: 'Omaha, Nebraska' },
            { name: 'Shadow Creek Golf Course', location: 'North Las Vegas, Nevada' },
            { name: 'Wynn Golf Club', location: 'Las Vegas, Nevada' },
            { name: 'Cascata Golf Club', location: 'Boulder City, Nevada' },
            { name: 'TPC Las Vegas', location: 'Las Vegas, Nevada' },
            { name: 'TPC Summerlin', location: 'Las Vegas, Nevada' },
            { name: 'Wolf Creek Golf Club', location: 'Mesquite, Nevada' },
            { name: 'Edgewood Tahoe Golf Course', location: 'Stateline, Nevada' },
            { name: 'Paiute Golf Resort', location: 'Las Vegas, Nevada' },
            { name: 'Reflection Bay Golf Club', location: 'Henderson, Nevada' },
            { name: 'Rio Secco Golf Club', location: 'Henderson, Nevada' },
            { name: 'The Balsams Resort', location: 'Dixville Notch, New Hampshire' },
            { name: 'Mount Washington Resort Golf Course', location: 'Bretton Woods, New Hampshire' },
            { name: 'Portsmouth Country Club', location: 'Greenland, New Hampshire' },
            { name: 'Breakfast Hill Golf Club', location: 'Greenland, New Hampshire' },
            { name: 'Owl\'s Nest Golf Club', location: 'Thornton, New Hampshire' },
            { name: 'Pine Valley Golf Club', location: 'Pine Valley, New Jersey' },
            { name: 'Baltusrol Golf Club', location: 'Springfield, New Jersey' },
            { name: 'Ridgewood Country Club', location: 'Paramus, New Jersey' },
            { name: 'Bayonne Golf Club', location: 'Bayonne, New Jersey' },
            { name: 'Galloway National Golf Club', location: 'Galloway, New Jersey' },
            { name: 'Somerset Hills Country Club', location: 'Bernardsville, New Jersey' },
            { name: 'Plainfield Country Club', location: 'Edison, New Jersey' },
            { name: 'Hamilton Farm Golf Club', location: 'Gladstone, New Jersey' },
            { name: 'Liberty National Golf Club', location: 'Jersey City, New Jersey' },
            { name: 'Trump National Golf Club Bedminster', location: 'Bedminster, New Jersey' },
            { name: 'Trump National Golf Club Colts Neck', location: 'Colts Neck, New Jersey' },
            { name: 'Metedeconk National Golf Club', location: 'Jackson, New Jersey' },
            { name: 'Arcola Country Club', location: 'Paramus, New Jersey' },
            { name: 'Fiddler\'s Elbow Country Club', location: 'Bedminster, New Jersey' },
            { name: 'Spring Lake Golf Club', location: 'Spring Lake, New Jersey' },
            { name: 'Black Mesa Golf Club', location: 'La Mesilla, New Mexico' },
            { name: 'Paa-Ko Ridge Golf Club', location: 'Sandia Park, New Mexico' },
            { name: 'Towa Golf Resort', location: 'Santa Fe, New Mexico' },
            { name: 'The Championship Golf Course at UNM', location: 'Albuquerque, New Mexico' },
            { name: 'Cochiti Golf Club', location: 'Cochiti Lake, New Mexico' },
            { name: 'Shinnecock Hills Golf Club', location: 'Southampton, New York' },
            { name: 'National Golf Links of America', location: 'Southampton, New York' },
            { name: 'Winged Foot Golf Club', location: 'Mamaroneck, New York' },
            { name: 'Bethpage State Park', location: 'Farmingdale, New York' },
            { name: 'Friar\'s Head', location: 'Baiting Hollow, New York' },
            { name: 'Sebonack Golf Club', location: 'Southampton, New York' },
            { name: 'The Bridge', location: 'Bridgehampton, New York' },
            { name: 'Maidstone Club', location: 'East Hampton, New York' },
            { name: 'Quaker Ridge Golf Club', location: 'Scarsdale, New York' },
            { name: 'Deepdale Golf Club', location: 'Manhasset, New York' },
            { name: 'Piping Rock Club', location: 'Locust Valley, New York' },
            { name: 'Garden City Golf Club', location: 'Garden City, New York' },
            { name: 'Hudson National Golf Club', location: 'Croton-on-Hudson, New York' },
            { name: 'Sleepy Hollow Country Club', location: 'Briarcliff Manor, New York' },
            { name: 'The Creek', location: 'Locust Valley, New York' },
            { name: 'Oak Hill Country Club', location: 'Pittsford, New York' },
            { name: 'Saratoga National Golf Club', location: 'Saratoga Springs, New York' },
            { name: 'Pinehurst No. 2', location: 'Pinehurst, North Carolina' },
            { name: 'Pinehurst No. 4', location: 'Pinehurst, North Carolina' },
            { name: 'Pinehurst No. 8', location: 'Pinehurst, North Carolina' },
            { name: 'Pinehurst No. 9', location: 'Pinehurst, North Carolina' },
            { name: 'Quail Hollow Club', location: 'Charlotte, North Carolina' },
            { name: 'Wade Hampton Golf Club', location: 'Cashiers, North Carolina' },
            { name: 'Linville Golf Club', location: 'Linville, North Carolina' },
            { name: 'Country Club of North Carolina', location: 'Pinehurst, North Carolina' },
            { name: 'Grandfather Golf and Country Club', location: 'Linville, North Carolina' },
            { name: 'Tobacco Road Golf Club', location: 'Sanford, North Carolina' },
            { name: 'Mid Pines Inn and Golf Club', location: 'Southern Pines, North Carolina' },
            { name: 'Pine Needles Lodge & Golf Club', location: 'Southern Pines, North Carolina' },
            { name: 'Bully Pulpit Golf Course', location: 'Medora, North Dakota' },
            { name: 'Hawktree Golf Club', location: 'Bismarck, North Dakota' },
            { name: 'The Links of North Dakota', location: 'Williston, North Dakota' },
            { name: 'Rose Creek Golf Course', location: 'Fargo, North Dakota' },
            { name: 'Edgewood Golf Course', location: 'Fargo, North Dakota' },
            { name: 'Muirfield Village Golf Club', location: 'Dublin, Ohio' },
            { name: 'Canterbury Golf Club', location: 'Beachwood, Ohio' },
            { name: 'Firestone Country Club', location: 'Akron, Ohio' },
            { name: 'Scioto Country Club', location: 'Columbus, Ohio' },
            { name: 'Camargo Club', location: 'Indian Hill, Ohio' },
            { name: 'The Golf Club', location: 'New Albany, Ohio' },
            { name: 'Double Eagle Club', location: 'Galena, Ohio' },
            { name: 'Valhalla at The Grand Resort', location: 'Warren, Ohio' },
            { name: 'Longaberger Golf Club', location: 'Nashport, Ohio' },
            { name: 'Kinsale Golf and Fitness Club', location: 'Powell, Ohio' },
            { name: 'Southern Hills Country Club', location: 'Tulsa, Oklahoma' },
            { name: 'Oak Tree National', location: 'Edmond, Oklahoma' },
            { name: 'The Patriot Golf Club', location: 'Owasso, Oklahoma' },
            { name: 'Karsten Creek Golf Club', location: 'Stillwater, Oklahoma' },
            { name: 'Shangri-La Golf Club', location: 'Afton, Oklahoma' },
            { name: 'Bandon Dunes Golf Resort', location: 'Bandon, Oregon' },
            { name: 'Pacific Dunes', location: 'Bandon, Oregon' },
            { name: 'Old Macdonald', location: 'Bandon, Oregon' },
            { name: 'Bandon Trails', location: 'Bandon, Oregon' },
            { name: 'Sheep Ranch', location: 'Bandon, Oregon' },
            { name: 'Pronghorn Golf Club', location: 'Bend, Oregon' },
            { name: 'Tetherow Golf Club', location: 'Bend, Oregon' },
            { name: 'Crosswater Club', location: 'Sunriver, Oregon' },
            { name: 'Silvies Valley Ranch', location: 'Seneca, Oregon' },
            { name: 'Portland Golf Club', location: 'Portland, Oregon' },
            { name: 'Eugene Country Club', location: 'Eugene, Oregon' },
            { name: 'The Reserve Vineyards & Golf Club', location: 'Aloha, Oregon' },
            { name: 'Merion Golf Club', location: 'Ardmore, Pennsylvania' },
            { name: 'Oakmont Country Club', location: 'Oakmont, Pennsylvania' },
            { name: 'Aronimink Golf Club', location: 'Newtown Square, Pennsylvania' },
            { name: 'Philadelphia Cricket Club', location: 'Flourtown, Pennsylvania' },
            { name: 'Philadelphia Country Club', location: 'Gladwyne, Pennsylvania' },
            { name: 'Laurel Valley Golf Club', location: 'Ligonier, Pennsylvania' },
            { name: 'Huntingdon Valley Country Club', location: 'Huntingdon Valley, Pennsylvania' },
            { name: 'Saucon Valley Country Club', location: 'Bethlehem, Pennsylvania' },
            { name: 'Fox Chapel Golf Club', location: 'Pittsburgh, Pennsylvania' },
            { name: 'Lancaster Country Club', location: 'Lancaster, Pennsylvania' },
            { name: 'Newport Country Club', location: 'Newport, Rhode Island' },
            { name: 'Wannamoisett Country Club', location: 'Rumford, Rhode Island' },
            { name: 'Shelter Harbor Golf Club', location: 'Charlestown, Rhode Island' },
            { name: 'Point Judith Country Club', location: 'Narragansett, Rhode Island' },
            { name: 'Misquamicut Club', location: 'Watch Hill, Rhode Island' },
            { name: 'Harbour Town Golf Links', location: 'Hilton Head Island, South Carolina' },
            { name: 'Kiawah Island Golf Resort', location: 'Kiawah Island, South Carolina' },
            { name: 'Yeamans Hall Club', location: 'Hanahan, South Carolina' },
            { name: 'Congaree Golf Club', location: 'Ridgeland, South Carolina' },
            { name: 'Caledonia Golf & Fish Club', location: 'Pawleys Island, South Carolina' },
            { name: 'TPC Myrtle Beach', location: 'Murrells Inlet, South Carolina' },
            { name: 'Dunes Golf & Beach Club', location: 'Myrtle Beach, South Carolina' },
            { name: 'Tidewater Golf Club', location: 'North Myrtle Beach, South Carolina' },
            { name: 'The Country Club of Charleston', location: 'Charleston, South Carolina' },
            { name: 'Sutton Bay Golf Club', location: 'Agar, South Dakota' },
            { name: 'The Bluffs Golf Course', location: 'Vermillion, South Dakota' },
            { name: 'Red Rock Golf Course', location: 'Rapid City, South Dakota' },
            { name: 'Willow Run Golf Course', location: 'Sioux Falls, South Dakota' },
            { name: 'Meadow Brook Golf Course', location: 'Rapid City, South Dakota' },
            { name: 'The Honors Course', location: 'Ooltewah, Tennessee' },
            { name: 'TPC Southwind', location: 'Memphis, Tennessee' },
            { name: 'Ridgeway Country Club', location: 'Memphis, Tennessee' },
            { name: 'Ridgeway Country Club', location: 'Neenah, Wisconsin' },
            { name: 'The Lookout Mountain Club', location: 'Lookout Mountain, Tennessee' },
            { name: 'Sweetens Cove Golf Club', location: 'South Pittsburg, Tennessee' },
            { name: 'Hermitage Golf Course', location: 'Old Hickory, Tennessee' },
            { name: 'Gaylord Springs Golf Links', location: 'Nashville, Tennessee' },
            { name: 'Colonial Country Club', location: 'Fort Worth, Texas' },
            { name: 'Preston Trail Golf Club', location: 'Dallas, Texas' },
            { name: 'Brook Hollow Golf Club', location: 'Dallas, Texas' },
            { name: 'Dallas National Golf Club', location: 'Dallas, Texas' },
            { name: 'Trinity Forest Golf Club', location: 'Dallas, Texas' },
            { name: 'Shady Oaks Country Club', location: 'Fort Worth, Texas' },
            { name: 'Houston Oaks Country Club', location: 'Hockley, Texas' },
            { name: 'Whispering Pines Golf Club', location: 'Trinity, Texas' },
            { name: 'Boot Ranch', location: 'Fredericksburg, Texas' },
            { name: 'Spanish Oaks Golf Club', location: 'Austin, Texas' },
            { name: 'The Golf Club at Star Ranch', location: 'Hutto, Texas' },
            { name: 'TPC San Antonio', location: 'San Antonio, Texas' },
            { name: 'Barton Creek Resort', location: 'Austin, Texas' },
            { name: 'The Clubs at Houston Oaks', location: 'Hockley, Texas' },
            { name: 'Champions Golf Club', location: 'Houston, Texas' },
            { name: 'Promontory Club', location: 'Park City, Utah' },
            { name: 'Thanksgiving Point Golf Club', location: 'Lehi, Utah' },
            { name: 'Sand Hollow Golf Club', location: 'Hurricane, Utah' },
            { name: 'Entrada at Snow Canyon', location: 'St. George, Utah' },
            { name: 'Victory Ranch Golf Club', location: 'Kamas, Utah' },
            { name: 'Soldier Hollow Golf Course', location: 'Midway, Utah' },
            { name: 'Red Ledges Golf Club', location: 'Heber City, Utah' },
            { name: 'Stowe Country Club', location: 'Stowe, Vermont' },
            { name: 'Okemo Valley Golf Club', location: 'Ludlow, Vermont' },
            { name: 'Equinox Golf Resort', location: 'Manchester, Vermont' },
            { name: 'Green Mountain National Golf Course', location: 'Killington, Vermont' },
            { name: 'Stratton Mountain Golf Club', location: 'Stratton, Vermont' },
            { name: 'The Homestead Resort', location: 'Hot Springs, Virginia' },
            { name: 'Kinloch Golf Club', location: 'Manakin-Sabot, Virginia' },
            { name: 'Robert Trent Jones Golf Club', location: 'Gainesville, Virginia' },
            { name: 'Ballyhack Golf Club', location: 'Roanoke, Virginia' },
            { name: 'Primland Resort', location: 'Meadows of Dan, Virginia' },
            { name: 'TPC Potomac at Avenel Farm', location: 'Potomac, Maryland' },
            { name: 'Keswick Hall & Golf Club', location: 'Keswick, Virginia' },
            { name: 'Independence Golf Club', location: 'Midlothian, Virginia' },
            { name: 'Kingsmill Resort', location: 'Williamsburg, Virginia' },
            { name: 'Chambers Bay Golf Course', location: 'University Place, Washington' },
            { name: 'Sahalee Country Club', location: 'Sammamish, Washington' },
            { name: 'The Golf Club at Newcastle', location: 'Newcastle, Washington' },
            { name: 'Salish Cliffs Golf Club', location: 'Shelton, Washington' },
            { name: 'Gold Mountain Golf Club', location: 'Bremerton, Washington' },
            { name: 'Gamble Sands Golf Club', location: 'Brewster, Washington' },
            { name: 'Wine Valley Golf Club', location: 'Walla Walla, Washington' },
            { name: 'The Greenbrier', location: 'White Sulphur Springs, West Virginia' },
            { name: 'Pete Dye Golf Club', location: 'Bridgeport, West Virginia' },
            { name: 'Stonewall Jackson Resort', location: 'Roanoke, West Virginia' },
            { name: 'The Resort at Glade Springs', location: 'Daniels, West Virginia' },
            { name: 'Oglebay Resort', location: 'Wheeling, West Virginia' },
            { name: 'Whistling Straits', location: 'Kohler, Wisconsin' },
            { name: 'Blackwolf Run', location: 'Kohler, Wisconsin' },
            { name: 'Erin Hills', location: 'Erin, Wisconsin' },
            { name: 'Sand Valley Golf Resort', location: 'Nekoosa, Wisconsin' },
            { name: 'Mammoth Dunes', location: 'Nekoosa, Wisconsin' },
            { name: 'Sentryworld Golf Course', location: 'Stevens Point, Wisconsin' },
            { name: 'Lawsonia Golf Links', location: 'Green Lake, Wisconsin' },
            { name: 'University Ridge Golf Course', location: 'Madison, Wisconsin' },
            { name: 'Geneva National Golf Club', location: 'Lake Geneva, Wisconsin' },
            { name: 'The Bull at Pinehurst Farms', location: 'Sheboygan Falls, Wisconsin' },
            { name: 'Jackson Hole Golf & Tennis Club', location: 'Jackson, Wyoming' },
            { name: '3 Creek Ranch Golf Club', location: 'Jackson, Wyoming' },
            { name: 'Shooting Star Golf Club', location: 'Teton Village, Wyoming' },
            { name: 'Teton Pines Country Club', location: 'Wilson, Wyoming' },
            { name: 'The Golf Club at Devil\'s Tower', location: 'Hulett, Wyoming' },
            { name: 'St Andrews Old Course', location: 'St Andrews, Scotland' },
            { name: 'Royal Dornoch', location: 'Dornoch, Scotland' },
            { name: 'Muirfield', location: 'Gullane, Scotland' },
            { name: 'Carnoustie Golf Links', location: 'Carnoustie, Scotland' },
            { name: 'Royal Troon Golf Club', location: 'Troon, Scotland' },
            { name: 'Trump Turnberry', location: 'Turnberry, Scotland' },
            { name: 'Trump Aberdeen', location: 'Balmedie, Scotland' },
            { name: 'Kingsbarns Golf Links', location: 'St Andrews, Scotland' },
            { name: 'North Berwick Golf Club', location: 'North Berwick, Scotland' },
            { name: 'Cruden Bay Golf Club', location: 'Cruden Bay, Scotland' },
            { name: 'Castle Stuart Golf Links', location: 'Inverness, Scotland' },
            { name: 'Gleneagles', location: 'Auchterarder, Scotland' },
            { name: 'Royal Birkdale Golf Club', location: 'Southport, England' },
            { name: 'Sunningdale Golf Club', location: 'Sunningdale, England' },
            { name: 'Wentworth Club', location: 'Virginia Water, England' },
            { name: 'Royal St George\'s Golf Club', location: 'Sandwich, England' },
            { name: 'Royal Liverpool Golf Club', location: 'Hoylake, England' },
            { name: 'Royal Lytham & St Annes', location: 'Lytham St Annes, England' },
            { name: 'Ballybunion Golf Club', location: 'Ballybunion, Ireland' },
            { name: 'Lahinch Golf Club', location: 'Lahinch, Ireland' },
            { name: 'Old Head Golf Links', location: 'Kinsale, Ireland' },
            { name: 'Portmarnock Golf Club', location: 'Dublin, Ireland' },
            { name: 'Waterville Golf Links', location: 'Waterville, Ireland' },
            { name: 'Trump International Doonbeg', location: 'Doonbeg, Ireland' },
            { name: 'Royal County Down', location: 'Newcastle, Northern Ireland' },
            { name: 'Royal Portrush', location: 'Portrush, Northern Ireland' },
            { name: 'Cabot Cliffs', location: 'Inverness, Nova Scotia, Canada' },
            { name: 'Cabot Links', location: 'Inverness, Nova Scotia, Canada' },
            { name: 'St George\'s Golf and Country Club', location: 'Toronto, Ontario, Canada' },
            { name: 'Jasper Park Lodge Golf Course', location: 'Jasper, Alberta, Canada' },
            { name: 'Emirates Golf Club', location: 'Dubai, UAE' },
            { name: 'Jumeirah Golf Estates', location: 'Dubai, UAE' },
            { name: 'Yas Links', location: 'Abu Dhabi, UAE' },
            { name: 'Saadiyat Beach Golf Club', location: 'Abu Dhabi, UAE' },
            { name: 'Al Hamra Golf Club', location: 'Ras Al Khaimah, UAE' },
            { name: 'Tower Links Golf Club', location: 'Ras Al Khaimah, UAE' },
            { name: 'Jebel Ali Golf Resort', location: 'Dubai, UAE' },
            { name: 'Dubai Creek Golf & Yacht Club', location: 'Dubai, UAE' },
            { name: 'The Els Club', location: 'Dubai, UAE' },
            { name: 'Abu Dhabi Golf Club', location: 'Abu Dhabi, UAE' },
            { name: 'Royal Melbourne', location: 'Melbourne, Australia' },
            { name: 'Kingston Heath Golf Club', location: 'Melbourne, Australia' },
            { name: 'Barnbougle Dunes', location: 'Bridport, Tasmania, Australia' },
            { name: 'Cape Kidnappers', location: 'Hawke\'s Bay, New Zealand' },
            { name: 'Kauri Cliffs', location: 'Matauri Bay, New Zealand' },
            { name: 'Tara Iti Golf Club', location: 'Mangawhai, New Zealand' },
            { name: 'Cabot Saint Lucia', location: 'Point Hardy, Saint Lucia' }
        ];

        // ==========================================
        // FAST LOCAL SEARCH WITH API FALLBACK
        // ==========================================
        
        // Function to search for golf courses - LOCAL FIRST, then Photon API
        function searchGolfCourses(query) {
            if (query.length < 2) {
                autocompleteDropdown.classList.remove('active');
                return;
            }

            // INSTANT LOCAL SEARCH
            const queryLower = query.toLowerCase().trim();
            
            const localResults = localCourseDatabase.filter(course => {
                const courseName = course.name.toLowerCase();
                // Fuzzy partial match - check if query is a substring OR if words match
                if (courseName.includes(queryLower)) return true;
                // Check if all query words appear somewhere in the course name (partial word match)
                const queryWords = queryLower.split(/\s+/);
                return queryWords.every(word => 
                    courseName.split(/\s+/).some(cw => cw.startsWith(word))
                );
            }).slice(0, 8);

            // Show local results immediately
            if (localResults.length > 0) {
                displayResults(localResults, query.length >= 3);
            }
            
            // Always also search Photon API if 3+ chars for additional results
            if (query.length >= 3) {
                if (!localResults.length) {
                    autocompleteDropdown.innerHTML = '<div class="autocomplete-loading">Searching...</div>';
                    autocompleteDropdown.classList.add('active');
                }
                searchWithPhotonAPI(query, localResults);
            } else if (!localResults.length) {
                autocompleteDropdown.innerHTML = '<div class="autocomplete-no-results">Keep typing to search...</div>';
                autocompleteDropdown.classList.add('active');
            }
        }

        // Photon API - fast, free geocoding with partial match support
        async function searchWithPhotonAPI(query, existingLocalResults) {
            try {
                const response = await fetch(
                    `https://photon.komoot.io/api/?q=${encodeURIComponent(query + ' golf')}&limit=15&lang=en`
                );
                
                if (!response.ok) throw new Error('Photon search failed');
                
                const data = await response.json();
                
                const results = data.features
                    .filter(f => {
                        const name = (f.properties.name || '').toLowerCase();
                        const type = (f.properties.osm_value || '').toLowerCase();
                        const queryLower = query.toLowerCase();
                        const queryWords = queryLower.split(/\s+/).filter(w => w.length > 2);
                        // Keep results that are golf-related OR match the query well
                        return name.includes('golf') || type.includes('golf') || 
                               type.includes('resort') || type.includes('leisure') ||
                               name.includes('resort') || name.includes('club') || name.includes('links') ||
                               queryWords.some(w => name.includes(w));
                    })
                    .map(f => {
                        const p = f.properties;
                        const city = p.city || p.county || p.town || p.village || '';
                        const state = p.state || '';
                        const country = p.country || '';
                        let location = '';
                        if (city && state && country !== 'United States') {
                            location = city + ', ' + country;
                        } else if (city && state) {
                            location = city + ', ' + state;
                        } else if (state && country) {
                            location = state + ', ' + country;
                        } else {
                            location = country;
                        }
                        return {
                            name: p.name || query,
                            location: location
                        };
                    })
                    .slice(0, 8);
                
                // Merge with local results, removing duplicates
                const existingNames = new Set(existingLocalResults.map(r => r.name.toLowerCase()));
                const newResults = results.filter(r => !existingNames.has(r.name.toLowerCase()));
                const combined = [...existingLocalResults, ...newResults].slice(0, 10);
                
                if (combined.length > 0) {
                    displayResults(combined, false);
                } else {
                    // Last resort: try Nominatim
                    searchWithOpenStreetMap(query);
                }
                
            } catch (error) {
                console.error('Photon search error:', error);
                // Fall back to Nominatim
                if (!existingLocalResults.length) {
                    searchWithOpenStreetMap(query);
                }
            }
        }

        // Fast OpenStreetMap search (faster than Google Places)
        async function searchWithOpenStreetMap(query) {
            try {
                const response = await fetch(
                    `https://nominatim.openstreetmap.org/search?` +
                    `q=${encodeURIComponent(query + ' golf course')}&` +
                    `format=json&` +
                    `limit=10&` +
                    `addressdetails=1`,
                    {
                        headers: {
                            'User-Agent': 'GolfCourseTracker/1.0'
                        }
                    }
                );

                if (!response.ok) {
                    throw new Error('Search failed');
                }

                const data = await response.json();
                
                const results = data
                    .filter(place => {
                        const name = place.display_name.toLowerCase();
                        return name.includes('golf');
                    })
                    .map(place => {
                        const parts = place.display_name.split(',');
                        let courseName = parts[0].trim();
                        
                        let location = '';
                        if (place.address) {
                            const city = place.address.city || place.address.town || place.address.village || '';
                            const state = place.address.state || '';
                            const country = place.address.country || '';
                            
                            if (city && state) {
                                location = `${city}, ${state}`;
                            } else if (city && country) {
                                location = `${city}, ${country}`;
                            } else if (state && country) {
                                location = `${state}, ${country}`;
                            } else {
                                location = country || parts.slice(-2).join(', ').trim();
                            }
                        } else {
                            location = parts.slice(-2).join(', ').trim();
                        }
                        
                        return {
                            name: courseName,
                            location: location
                        };
                    })
                    .slice(0, 10);

                displayResults(results);
                
            } catch (error) {
                console.error('OpenStreetMap search error:', error);
                autocompleteDropdown.innerHTML = '<div class="autocomplete-no-results">Search unavailable. Please enter course name manually.</div>';
            }
        }

        // Google API search (kept as backup but not actively used due to speed)
        function searchWithGoogleAPI(query) {
            if (!autocompleteService) {
                searchWithOpenStreetMap(query);
                return;
            }

            try {
                const request = {
                    input: query + ' golf course',
                    types: ['establishment']
                };

                autocompleteService.getPlacePredictions(request, (predictions, status) => {
                    if (status !== google.maps.places.PlacesServiceStatus.OK || !predictions) {
                        // Fallback to OpenStreetMap
                        searchWithOpenStreetMap(query);
                        return;
                    }

                    const results = predictions
                        .filter(prediction => {
                            const desc = prediction.description.toLowerCase();
                            return desc.includes('golf');
                        })
                        .slice(0, 10)
                        .map(prediction => {
                            const name = prediction.structured_formatting.main_text;
                            const location = prediction.structured_formatting.secondary_text || '';
                            return { name, location };
                        });

                    displayResults(results);
                });
            } catch (error) {
                console.error('Google API error:', error);
                searchWithOpenStreetMap(query);
            }
        }

        // Display search results
        function displayResults(results, stillSearching) {
            const currentQuery = courseNameInput.value.trim();
            if (results.length === 0) {
                autocompleteDropdown.classList.add('active');
                autocompleteDropdown.innerHTML = 
                    '<div class="autocomplete-no-results">No courses found in database.</div>' +
                    (currentQuery.length >= 3 ? '<div class="autocomplete-item autocomplete-use-custom" data-name="' + escapeHtml(currentQuery) + '" data-location="" style="border-top: 1px solid #eee; color: #2c5f2d; font-style: italic;">' +
                    '<div class="autocomplete-item-name">‚úèÔ∏è Use "' + escapeHtml(currentQuery) + '"</div>' +
                    '<div class="autocomplete-item-location">Enter this course name manually</div></div>' : '');
            } else {
                autocompleteDropdown.classList.add('active');
                // Check if query exactly matches any result
                const queryLower = currentQuery.toLowerCase();
                const exactMatch = results.some(c => c.name.toLowerCase() === queryLower);
                
                autocompleteDropdown.innerHTML = results.map(course => `
                    <div class="autocomplete-item" data-name="${escapeHtml(course.name)}" data-location="${escapeHtml(course.location)}">
                        <div class="autocomplete-item-name">${escapeHtml(course.name)}</div>
                        <div class="autocomplete-item-location">${escapeHtml(course.location)}</div>
                    </div>
                `).join('') + 
                (stillSearching ? '<div class="autocomplete-loading" style="font-size:11px; padding:6px 12px;">Searching for more courses...</div>' : '') +
                (!exactMatch && currentQuery.length >= 3 ? '<div class="autocomplete-item autocomplete-use-custom" data-name="' + escapeHtml(currentQuery) + '" data-location="" style="border-top: 1px solid #eee; color: #2c5f2d; font-style: italic;">' +
                '<div class="autocomplete-item-name">‚úèÔ∏è Don\'t see your course? Use "' + escapeHtml(currentQuery) + '"</div>' +
                '<div class="autocomplete-item-location">Enter manually and fill in details</div></div>' : '');

                // Add click handlers to each result
                document.querySelectorAll('.autocomplete-item').forEach(item => {
                    item.addEventListener('click', async function() {
                        const courseName = this.getAttribute('data-name');
                        const location = this.getAttribute('data-location');
                        
                        courseNameInput.value = courseName;
                        
                        // Parse location string into city, state, country
                        // Location format is typically "City, State" or "City, Country"
                        if (location) {
                            const parts = location.split(',').map(p => p.trim());
                            
                            // Fill city
                            const cityInput = document.getElementById('city');
                            if (cityInput && parts.length > 0) {
                                cityInput.value = parts[0];
                            }
                            
                            // Fill state
                            const stateInput = document.getElementById('state');
                            if (stateInput && parts.length > 1) {
                                stateInput.value = parts[1];
                            }
                            
                            // Fill country - default to USA if it looks like a US state
                            const countryInput = document.getElementById('country');
                            if (countryInput) {
                                if (parts.length > 1) {
                                    // Check if second part is a US state (2 letters)
                                    if (parts[1].length === 2) {
                                        countryInput.value = 'USA';
                                    } else {
                                        countryInput.value = parts[1];
                                    }
                                }
                            }
                        }
                        
                        // Auto-fill website FIRST, then try to get address FROM the website
                        const statusEl = document.getElementById('addressLookupStatus');
                        statusEl.innerHTML = '<span class="loading">Looking up details...</span>';
                        
                        // Step 1: Find the website
                        const websiteInput = document.getElementById('website');
                        if (websiteInput && !websiteInput.value) {
                            await findCourseWebsite(courseName, location, websiteInput);
                        }
                        
                        // Step 2: Try to get address from the website (if found)
                        const addressInput = document.getElementById('address');
                        if (websiteInput.value && addressInput && !addressInput.value) {
                            const foundAddress = await scrapeAddressFromWebsite(websiteInput.value, courseName);
                            if (foundAddress) {
                                addressInput.value = foundAddress;
                                statusEl.innerHTML = '‚úì Address found from website';
                                setTimeout(() => statusEl.textContent = '', 3000);
                            }
                        }
                        
                        // Step 3: If no address from website, try Nominatim
                        if (addressInput && !addressInput.value) {
                            try {
                                const locationHint = location ? ', ' + location : '';
                                const nomResponse = await fetch(
                                    `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(courseName + locationHint)}&limit=5&addressdetails=1&extratags=1&countrycodes=${location && location.match(/\b(Alabama|Alaska|Arizona|Arkansas|California|Colorado|Connecticut|Delaware|Florida|Georgia|Hawaii|Idaho|Illinois|Indiana|Iowa|Kansas|Kentucky|Louisiana|Maine|Maryland|Massachusetts|Michigan|Minnesota|Mississippi|Missouri|Montana|Nebraska|Nevada|New Hampshire|New Jersey|New Mexico|New York|North Carolina|North Dakota|Ohio|Oklahoma|Oregon|Pennsylvania|Rhode Island|South Carolina|South Dakota|Tennessee|Texas|Utah|Vermont|Virginia|Washington|West Virginia|Wisconsin|Wyoming)\b/i) ? 'us' : ''}`,
                                    { headers: { 'User-Agent': 'GolfCourseTracker/1.0' } }
                                );
                                const nomData = await nomResponse.json();
                                
                                const courseNameClean = courseName.toLowerCase().replace(/^the\s+/i, '').replace(/[^a-z0-9\s]/g, '');
                                const courseWords = courseNameClean.split(/\s+/).filter(w => w.length > 2);
                                const locationLower = (location || '').toLowerCase();
                                
                                // Score and rank all results
                                const existingCity = (document.getElementById('city')?.value || '').trim().toLowerCase();
                                const existingState = (document.getElementById('state')?.value || '').trim().toLowerCase();
                                
                                const scoredResults = nomData
                                    .filter(r => r.address)
                                    .map(r => {
                                        const rName = (r.name || r.display_name.split(',')[0] || '').toLowerCase()
                                            .replace(/^the\s+/i, '').replace(/[^a-z0-9\s]/g, '');
                                        const rWords = rName.split(/\s+/).filter(w => w.length > 2);
                                        const rDisplay = (r.display_name || '').toLowerCase();
                                        
                                        let matchCount = 0;
                                        for (const cw of courseWords) {
                                            if (rWords.some(rw => rw.includes(cw) || cw.includes(rw))) matchCount++;
                                        }
                                        let score = courseWords.length > 0 ? matchCount / courseWords.length : 0;
                                        
                                        if (locationLower) {
                                            const locParts = locationLower.split(',').map(p => p.trim());
                                            let locMatch = false;
                                            for (const part of locParts) {
                                                if (part && part.length > 2 && rDisplay.includes(part)) {
                                                    score += 0.3;
                                                    locMatch = true;
                                                }
                                            }
                                            if (!locMatch && locParts.some(p => p.length > 2)) {
                                                score -= 0.4;
                                            }
                                        }
                                        return { result: r, score };
                                    })
                                    .filter(s => s.score >= 0.5)
                                    .sort((a, b) => b.score - a.score);
                                
                                // Iterate ranked results, skip any with city/state conflict
                                let addressFound = false;
                                for (const { result } of scoredResults) {
                                    const a = result.address;
                                    const nomCity = (a.city || a.town || a.village || '').toLowerCase();
                                    const nomState = (a.state || '').toLowerCase();
                                    
                                    let locationConflict = false;
                                    if (existingCity && nomCity && !nomCity.includes(existingCity) && !existingCity.includes(nomCity)) {
                                        locationConflict = true;
                                    }
                                    if (existingState && nomState && !nomState.includes(existingState) && !existingState.includes(nomState)) {
                                        locationConflict = true;
                                    }
                                    
                                    if (locationConflict) continue; // Try next result
                                    
                                    const addressParts = [];
                                    if (a.house_number && a.road) addressParts.push(a.house_number + ' ' + a.road);
                                    else if (a.road) addressParts.push(a.road);
                                    if (a.city || a.town || a.village) addressParts.push(a.city || a.town || a.village);
                                    if (a.state) addressParts.push(a.state);
                                    if (a.postcode) addressParts.push(a.postcode);
                                    if (a.country) addressParts.push(a.country);
                                    
                                    if (addressParts.length > 0) {
                                        addressInput.value = addressParts.join(', ');
                                        statusEl.innerHTML = '‚úì Address found';
                                        setTimeout(() => statusEl.textContent = '', 3000);
                                    }
                                    
                                    const cityInput = document.getElementById('city');
                                    const stateInput = document.getElementById('state');
                                    const countryInput = document.getElementById('country');
                                    if (cityInput && !cityInput.value) cityInput.value = a.city || a.town || a.village || '';
                                    if (stateInput && !stateInput.value) stateInput.value = a.state || '';
                                    if (countryInput && !countryInput.value) countryInput.value = a.country || '';
                                    addressFound = true;
                                    break;
                                }
                                
                                if (!addressFound) {
                                    statusEl.textContent = '';
                                }
                            } catch (error) {
                                statusEl.textContent = '';
                            }
                        } else if (addressInput && addressInput.value) {
                            // Address was found from website, already shown
                        } else {
                            statusEl.textContent = '';
                        }
                        
                        autocompleteDropdown.classList.remove('active');
                    });
                });
            }
        }

        // Function to scrape address from a golf course website using a CORS proxy
        async function scrapeAddressFromWebsite(websiteUrl, courseName) {
            // Try main URL first, then common subpages like /contact
            const urlsToTry = [websiteUrl];
            try {
                const baseUrl = new URL(websiteUrl);
                const base = baseUrl.origin;
                urlsToTry.push(base + '/contact');
                urlsToTry.push(base + '/contact-us');
                urlsToTry.push(base + '/about');
                urlsToTry.push(base + '/location');
                urlsToTry.push(base + '/directions');
            } catch(e) {}
            
            for (const url of urlsToTry) {
                try {
                    const result = await scrapeAddressFromSinglePage(url);
                    if (result) return result;
                } catch(e) {}
            }
            return null;
        }
        
        async function scrapeAddressFromSinglePage(pageUrl) {
            try {
                // Use allorigins.win as a free CORS proxy
                const proxyUrl = 'https://api.allorigins.win/raw?url=' + encodeURIComponent(pageUrl);
                const response = await fetch(proxyUrl, { signal: AbortSignal.timeout(8000) });
                
                if (!response.ok) return null;
                
                const html = await response.text();
                
                // Strategy 1: Look for structured data (JSON-LD) ‚Äî most reliable
                const jsonLdMatches = html.match(/<script[^>]*type\s*=\s*["']application\/ld\+json["'][^>]*>([\s\S]*?)<\/script>/gi);
                if (jsonLdMatches) {
                    for (const match of jsonLdMatches) {
                        try {
                            const jsonStr = match.replace(/<\/?script[^>]*>/gi, '').trim();
                            const jsonData = JSON.parse(jsonStr);
                            // Recursively search for address objects
                            function findAddress(obj) {
                                if (!obj || typeof obj !== 'object') return null;
                                if (obj.streetAddress || obj.addressLocality) {
                                    const parts = [];
                                    if (obj.streetAddress) parts.push(obj.streetAddress);
                                    if (obj.addressLocality) parts.push(obj.addressLocality);
                                    if (obj.addressRegion) parts.push(obj.addressRegion);
                                    if (obj.postalCode) parts.push(obj.postalCode);
                                    if (parts.length >= 2) return parts.join(', ');
                                }
                                if (obj.address) return findAddress(obj.address);
                                if (Array.isArray(obj)) {
                                    for (const item of obj) {
                                        const found = findAddress(item);
                                        if (found) return found;
                                    }
                                }
                                if (obj['@graph']) return findAddress(obj['@graph']);
                                for (const key of Object.keys(obj)) {
                                    if (typeof obj[key] === 'object') {
                                        const found = findAddress(obj[key]);
                                        if (found) return found;
                                    }
                                }
                                return null;
                            }
                            const addr = findAddress(jsonData);
                            if (addr) return addr;
                        } catch (e) { /* invalid JSON, skip */ }
                    }
                }
                
                // Strategy 2: Look for address in microdata or common HTML patterns
                // Look for elements with address-like attributes
                const addressAttrPatterns = [
                    /itemprop\s*=\s*["']streetAddress["'][^>]*>([^<]+)/gi,
                    /class\s*=\s*["'][^"']*(?:street|address)[^"']*["'][^>]*>([^<]+)/gi,
                    /id\s*=\s*["'][^"']*(?:street|address)[^"']*["'][^>]*>([^<]+)/gi
                ];
                
                for (const pattern of addressAttrPatterns) {
                    const attrMatch = pattern.exec(html);
                    if (attrMatch) {
                        const streetText = attrMatch[1].trim();
                        // Look for city/state/zip nearby in the HTML
                        const afterMatch = html.substring(attrMatch.index, attrMatch.index + 500);
                        const cityStateZip = afterMatch.match(/(?:>|\s)([A-Z][a-zA-Z\s]+),?\s*(?:,\s*)?([A-Z]{2})\s+(\d{5})/);
                        if (cityStateZip && streetText.match(/^\d+/)) {
                            return streetText + ', ' + cityStateZip[1].trim() + ', ' + cityStateZip[2] + ' ' + cityStateZip[3];
                        }
                    }
                }
                
                // Strategy 3: Look for common address patterns in the HTML text
                // Use a separator that preserves line-break boundaries from HTML elements
                const textContent = html
                    .replace(/<br\s*\/?>/gi, ', ')
                    .replace(/<\/(?:div|p|span|li|td|h\d|a|address)[^>]*>/gi, ', ')
                    .replace(/<[^>]+>/g, ' ')
                    .replace(/\s*,\s*/g, ', ')
                    .replace(/\s+/g, ' ');
                
                // US address: number + street name with street suffix + city + state + zip
                const usAddressPattern = /(\d+\s+[A-Za-z\s.]{2,35}(?:Street|St|Avenue|Ave|Road|Rd|Drive|Dr|Boulevard|Blvd|Lane|Ln|Way|Court|Ct|Circle|Cir|Place|Pl|Parkway|Pkwy|Trail|Trl|Terrace|Ter)[.,]?\s*,?\s*[A-Za-z\s]+,?\s*[A-Z]{2}\s*\d{5}(?:-\d{4})?)/gi;
                const usMatches = textContent.match(usAddressPattern);
                if (usMatches && usMatches.length > 0) {
                    // Clean up extra spaces and commas
                    return usMatches[0].trim().replace(/\s*,\s*/g, ', ').replace(/,\s*,/g, ',');
                }
                
                // Simpler pattern: number + words + state abbrev + zip (with or without commas)
                const simpleUsPattern = /(\d+\s+[A-Za-z\s.]{3,40}[,\s]+[A-Za-z\s]+[,\s]+[A-Z]{2}\s+\d{5})/g;
                const simpleMatches = textContent.match(simpleUsPattern);
                if (simpleMatches && simpleMatches.length > 0) {
                    return simpleMatches[0].trim().replace(/\s*,\s*/g, ', ').replace(/,\s*,/g, ',');
                }

                // Strategy 4: Look for zip code and work backwards to find a street number
                const zipPattern = /(\d+\s+[A-Za-z\s.]{3,50}?\s*,?\s*[A-Za-z\s]+?\s*,?\s*[A-Za-z]+\s+\d{5})/g;
                const zipMatches = textContent.match(zipPattern);
                if (zipMatches) {
                    // Find the one most likely to be an address (starts with a street number, has state + zip)
                    for (const m of zipMatches) {
                        if (m.match(/^\d+\s+[A-Za-z]/) && m.match(/[A-Z]{2}\s+\d{5}/)) {
                            return m.trim().replace(/\s*,\s*/g, ', ').replace(/,\s*,/g, ',');
                        }
                    }
                }
                
                // Strategy 5: Look for address in meta tags
                const metaPatterns = [
                    /content\s*=\s*["'](\d+[^"']*(?:Street|St|Avenue|Ave|Road|Rd|Drive|Dr|Boulevard|Blvd|Lane|Ln|Way|Court|Ct)[^"']*\d{5}[^"']*)["']/i,
                    /content\s*=\s*["'](\d+[^"']{5,60}\d{5}[^"']*)["']/i,
                    /"(?:street[_-]?address|address)"[:\s]*"([^"]+\d{5}[^"]*)"/i
                ];
                for (const mp of metaPatterns) {
                    const metaMatch = html.match(mp);
                    if (metaMatch) {
                        return metaMatch[1].trim();
                    }
                }
                
                // Strategy 6: Look for "address" or "located at" label near text with a zip code
                const addressLabelPatterns = [
                    /ADDRESS\s*[:\s¬∑|]*\s*(\d+[^<\n¬∑|]{5,100}\d{5}(?:-\d{4})?)/i,
                    /(?:located|location|find us)\s+(?:at|:)\s*(\d+[^<\n]{5,100}\d{5}(?:-\d{4})?)/i,
                    /[Aa]ddress[:\s]*,?\s*(\d+[^<\n]{5,100}\d{5}(?:-\d{4})?)/
                ];
                for (const alp of addressLabelPatterns) {
                    const addressBlock = textContent.match(alp);
                    if (addressBlock) {
                        return addressBlock[1].trim().replace(/^\s*[:|-]\s*/, '').replace(/\s*,\s*/g, ', ');
                    }
                }
                
                // Strategy 7: Just find any 5-digit zip with a street number before it
                const lastResort = textContent.match(/(\d+\s+\w[\w\s.]{2,30}\w\s*,?\s*\w[\w\s]*\w\s*,?\s*[A-Z]{2}\s+\d{5})/);
                if (lastResort) {
                    return lastResort[1].trim().replace(/\s*,\s*/g, ', ').replace(/,\s*,/g, ',');
                }
                
                return null;
            } catch (error) {
                console.log('Website scrape failed:', error.message);
                return null;
            }
        }

        // Function to intelligently find course website
        // Uses location to disambiguate courses with the same name
        async function findCourseWebsite(courseName, courseLocation, websiteInput) {
            const locationStr = courseLocation || '';
            const searchQuery = courseName + (locationStr ? ' ' + locationStr : '');
            
            try {
                // Step 1: Nominatim with extratags - best for location-specific results
                // This is tried first because it uses geo-data to disambiguate same-name courses
                try {
                    const nomResponse = await fetch(
                        `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(searchQuery + ' golf')}&limit=5&extratags=1`,
                        { headers: { 'User-Agent': 'GolfCourseTracker/1.0' } }
                    );
                    const nomData = await nomResponse.json();
                    
                    // Score results by name AND location match
                    const courseNameClean = courseName.toLowerCase().replace(/^the\s+/i, '').replace(/[^a-z0-9\s]/g, '');
                    const courseWords = courseNameClean.split(/\s+/).filter(w => w.length > 2);
                    const locationLower = locationStr.toLowerCase();
                    
                    let bestResult = null;
                    let bestScore = -1;
                    
                    for (const r of nomData) {
                        const rName = (r.name || r.display_name.split(',')[0] || '').toLowerCase()
                            .replace(/^the\s+/i, '').replace(/[^a-z0-9\s]/g, '');
                        const rWords = rName.split(/\s+/).filter(w => w.length > 2);
                        const rDisplay = (r.display_name || '').toLowerCase();
                        
                        // Name match score
                        let matchCount = 0;
                        for (const cw of courseWords) {
                            if (rWords.some(rw => rw.includes(cw) || cw.includes(rw))) matchCount++;
                        }
                        let score = courseWords.length > 0 ? matchCount / courseWords.length : 0;
                        
                        // Location bonus - boost score if location matches
                        if (locationLower) {
                            const locParts = locationLower.split(',').map(p => p.trim());
                            for (const part of locParts) {
                                if (part && rDisplay.includes(part)) score += 0.3;
                            }
                        }
                        
                        if (score > bestScore) {
                            bestScore = score;
                            bestResult = r;
                        }
                    }
                    
                    if (bestResult && bestScore >= 0.5 && bestResult.extratags) {
                        const website = bestResult.extratags.website || bestResult.extratags.url || bestResult.extratags.contact_website;
                        if (website) {
                            let url = website;
                            if (!url.startsWith('http')) url = 'https://' + url;
                            websiteInput.value = url;
                            return;
                        }
                    }
                } catch (e) {
                    console.log('Nominatim extratags lookup failed');
                }

                // Step 2: DuckDuckGo Instant Answer API - include location for disambiguation
                try {
                    const ddgResponse = await fetch(
                        'https://api.duckduckgo.com/?q=' + encodeURIComponent(searchQuery + ' golf club official site') + '&format=json&no_redirect=1'
                    );
                    const ddgData = await ddgResponse.json();
                    
                    if (ddgData.Results && ddgData.Results.length > 0) {
                        const firstUrl = ddgData.Results[0].FirstURL;
                        if (firstUrl && !firstUrl.includes('duckduckgo.com') && !firstUrl.includes('wikipedia.org')) {
                            websiteInput.value = firstUrl;
                            return;
                        }
                    }
                    
                    if (ddgData.Infobox && ddgData.Infobox.content) {
                        for (const item of ddgData.Infobox.content) {
                            if (item.label && item.label.toLowerCase() === 'website' && item.value) {
                                let url = item.value;
                                if (!url.startsWith('http')) url = 'https://' + url;
                                websiteInput.value = url;
                                return;
                            }
                        }
                    }
                    
                    if (ddgData.AbstractURL && !ddgData.AbstractURL.includes('wikipedia.org')) {
                        websiteInput.value = ddgData.AbstractURL;
                        return;
                    }
                } catch (e) {
                    console.log('DuckDuckGo lookup failed');
                }

                // Step 3: Wikipedia lookup
                try {
                    const wikiQuery = encodeURIComponent(courseName);
                    const wikiResponse = await fetch(
                        'https://en.wikipedia.org/w/api.php?action=query&format=json&origin=*&prop=revisions|info&rvprop=content&rvslots=main&titles=' + wikiQuery + '&inprop=url'
                    );
                    const wikiData = await wikiResponse.json();
                    
                    if (wikiData.query && wikiData.query.pages) {
                        const pages = Object.values(wikiData.query.pages);
                        if (pages.length > 0 && pages[0].pageid) {
                            const page = pages[0];
                            if (page.revisions && page.revisions[0] && page.revisions[0].slots && page.revisions[0].slots.main) {
                                const content = page.revisions[0].slots.main['*'];
                                // Check if Wikipedia content mentions our location
                                const contentLower = content.toLowerCase();
                                const locationMatch = !locationStr || locationStr.split(',').some(p => 
                                    p.trim() && contentLower.includes(p.trim().toLowerCase())
                                );
                                
                                if (locationMatch) {
                                    const websitePatterns = [
                                        /\|\s*website\s*=\s*\{?\s*(?:URL\|)?(?:\[)?(https?:\/\/[^\s\]|}]+)/i,
                                        /\|\s*url\s*=\s*\[?(https?:\/\/[^\s\]|]+)/i,
                                        /\|\s*homepage\s*=\s*\[?(https?:\/\/[^\s\]|]+)/i
                                    ];
                                    for (const pattern of websitePatterns) {
                                        const match = content.match(pattern);
                                        if (match) {
                                            let url = (match[1] || match[0]).replace(/^\[/, '').replace(/\]$/, '').replace(/\|.*$/, '').trim();
                                            if (url && !url.includes('facebook.com') && !url.includes('twitter.com') && 
                                                !url.includes('instagram.com') && !url.includes('youtube.com')) {
                                                websiteInput.value = url;
                                                return;
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                } catch (e) {
                    console.log('Wikipedia lookup failed');
                }

                // Step 4: Nothing found, leave blank
                websiteInput.value = '';
                
            } catch (error) {
                console.error('Website lookup error:', error);
                websiteInput.value = '';
            }
        }

        // Helper function to escape HTML to prevent XSS
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Listen for typing in course name field
        courseNameInput.addEventListener('input', function(e) {
            const query = e.target.value.trim();
            
            // Clear previous timeout
            if (autocompleteTimeout) {
                clearTimeout(autocompleteTimeout);
            }
            
            // Wait only 80ms after user stops typing before searching
            autocompleteTimeout = setTimeout(() => {
                searchGolfCourses(query);
            }, 80);
        });

        // Close dropdown when clicking outside
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.autocomplete-container')) {
                autocompleteDropdown.classList.remove('active');
            }
        });

        // Close dropdown when input loses focus (but delay to allow click on dropdown)
        courseNameInput.addEventListener('blur', function() {
            setTimeout(() => {
                autocompleteDropdown.classList.remove('active');
            }, 200);
        });

        // ==========================================
        // REFRESH INFO BUTTON
        // Manually re-fetch address and website when course name is changed
        // ==========================================
        document.getElementById('btnRefreshInfo').addEventListener('click', async function() {
            const courseName = courseNameInput.value.trim();
            
            if (!courseName || courseName.length < 3) {
                alert('Please enter a course name first');
                return;
            }
            
            const statusEl = document.getElementById('addressLookupStatus');
            statusEl.innerHTML = '<span class="loading">Looking up address and website...</span>';
            
            const existingCity = (document.getElementById('city')?.value || '').trim().toLowerCase();
            const existingState = (document.getElementById('state')?.value || '').trim().toLowerCase();
            
            // Look up address
            try {
                const locationHint = existingCity ? ', ' + existingCity : '';
                const stateHint = existingState ? ', ' + existingState : '';
                const response = await fetch(
                    `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(courseName + locationHint + stateHint)}&limit=5&addressdetails=1`,
                    { headers: { 'User-Agent': 'GolfCourseTracker/1.0' } }
                );
                
                const data = await response.json();
                
                let addressFound = false;
                for (const result of data) {
                    if (!result.address) continue;
                    const a = result.address;
                    const nomCity = (a.city || a.town || a.village || '').toLowerCase();
                    const nomState = (a.state || '').toLowerCase();
                    
                    // Skip results that conflict with existing city/state
                    let conflict = false;
                    if (existingCity && nomCity && !nomCity.includes(existingCity) && !existingCity.includes(nomCity)) conflict = true;
                    if (existingState && nomState && !nomState.includes(existingState) && !existingState.includes(nomState)) conflict = true;
                    if (conflict) continue;
                    
                    const addressParts = [];
                    if (a.house_number && a.road) addressParts.push(a.house_number + ' ' + a.road);
                    else if (a.road) addressParts.push(a.road);
                    if (a.city || a.town || a.village) addressParts.push(a.city || a.town || a.village);
                    if (a.state) addressParts.push(a.state);
                    if (a.postcode) addressParts.push(a.postcode);
                    if (a.country) addressParts.push(a.country);
                    
                    if (addressParts.length > 0) {
                        document.getElementById('address').value = addressParts.join(', ');
                        statusEl.innerHTML = '‚úì Address found';
                        setTimeout(() => statusEl.textContent = '', 3000);
                    }
                    
                    if (!existingCity && (a.city || a.town || a.village)) {
                        document.getElementById('city').value = a.city || a.town || a.village;
                    }
                    if (!existingState && a.state) {
                        document.getElementById('state').value = a.state;
                    }
                    if (a.country && !document.getElementById('country').value) {
                        document.getElementById('country').value = a.country;
                    }
                    addressFound = true;
                    break;
                }
                
                if (!addressFound) {
                    statusEl.textContent = 'Could not find a matching address';
                    setTimeout(() => statusEl.textContent = '', 3000);
                }
            } catch (error) {
                statusEl.textContent = 'Could not lookup address';
                setTimeout(() => statusEl.textContent = '', 3000);
            }
            
            // Look up website
            const websiteInput = document.getElementById('website');
            if (websiteInput) {
                const cityVal = document.getElementById('city') ? document.getElementById('city').value : '';
                const stateVal = document.getElementById('state') ? document.getElementById('state').value : '';
                const refreshLocation = [cityVal, stateVal].filter(Boolean).join(', ');
                await findCourseWebsite(courseName, refreshLocation, websiteInput);
            }
        });

        // ==========================================
        // BUTTON CLICK HANDLERS - VIEW TOGGLE
        // These make the "Wish List", "Played", and "Add" buttons work
        // ==========================================
        
        // When "Wish List" button is clicked
        document.getElementById('btnShowWishList').addEventListener('click', function() {
            document.getElementById('wishListContainer').classList.add('active');
            document.getElementById('playedListContainer').classList.remove('active');
            document.getElementById('addForm').classList.remove('active');
            if (wishlistCourses.length > 0) document.getElementById('wishListSortControls').style.display = 'flex';
            document.getElementById('playedListSortControls').style.display = 'none';
            
            this.classList.add('active');
            document.getElementById('btnShowPlayedList').classList.remove('active');
            document.getElementById('btnShowAdd').classList.remove('active');
        });

        // When "Played" button is clicked
        document.getElementById('btnShowPlayedList').addEventListener('click', function() {
            document.getElementById('playedListContainer').classList.add('active');
            document.getElementById('wishListContainer').classList.remove('active');
            document.getElementById('addForm').classList.remove('active');
            if (playedCourses.length > 0) document.getElementById('playedListSortControls').style.display = 'flex';
            document.getElementById('wishListSortControls').style.display = 'none';
            
            this.classList.add('active');
            document.getElementById('btnShowWishList').classList.remove('active');
            document.getElementById('btnShowAdd').classList.remove('active');
        });

        // When "Add" button is clicked
        document.getElementById('btnShowAdd').addEventListener('click', function() {
            document.getElementById('addForm').classList.add('active');
            document.getElementById('wishListContainer').classList.remove('active');
            document.getElementById('playedListContainer').classList.remove('active');
            document.getElementById('wishListSortControls').style.display = 'none';
            document.getElementById('playedListSortControls').style.display = 'none';
            
            this.classList.add('active');
            document.getElementById('btnShowWishList').classList.remove('active');
            document.getElementById('btnShowPlayedList').classList.remove('active');
        });

        // When "Cancel" button is clicked on the form
        document.getElementById('btnCancelAdd').addEventListener('click', function() {
            // Clear editing state ‚Äî original entry stays untouched
            editingId = null;
            editingType = null;
            document.getElementById('btnSubmitCourse').textContent = 'Add Course';
            document.getElementById('btnDeleteFromForm').style.display = 'none';
            
            document.getElementById('btnShowWishList').click();
            document.getElementById('courseForm').reset();
            playersArray = [];
            renderPlayersList();
            photosArray = [];
            renderPhotosPreview();
            // Reset to wishlist by default
            document.querySelector('input[name="listType"][value="wishlist"]').checked = true;
            showWishlistFields();
        });

        // ==========================================
        // TOGGLE BETWEEN WISH LIST AND PLAYED FIELDS
        // Show/hide different form fields based on selection
        // ==========================================
        document.querySelectorAll('input[name="listType"]').forEach(radio => {
            radio.addEventListener('change', function() {
                if (this.value === 'wishlist') {
                    showWishlistFields();
                } else {
                    showPlayedFields();
                }
            });
        });

        function showWishlistFields() {
            document.getElementById('wishlistFields').style.display = 'block';
            document.getElementById('playedFields').style.display = 'none';
            // Make date NOT required for wishlist
            document.getElementById('datePlayed').removeAttribute('required');
        }

        function showPlayedFields() {
            document.getElementById('wishlistFields').style.display = 'none';
            document.getElementById('playedFields').style.display = 'block';
            // Make date required for played
            document.getElementById('datePlayed').setAttribute('required', 'required');
        }

        // ==========================================
        // PLAYERS LIST (People Played With)
        // Add one person at a time with name, company, email
        // ==========================================
        let playersArray = [];  // Stores the list of players for the current form

        function renderPlayersList() {
            const listEl = document.getElementById('playersList');
            if (playersArray.length === 0) {
                listEl.innerHTML = '';
                return;
            }
            listEl.innerHTML = playersArray.map(function(player, index) {
                let detailParts = [];
                if (player.company) detailParts.push(player.company);
                if (player.email) detailParts.push(player.email);
                const detailStr = detailParts.length > 0 ? detailParts.join(' ¬∑ ') : '';
                return '<div class="player-chip">' +
                    '<div class="player-chip-info">' +
                        '<div class="player-chip-name">' + escapeHtml(player.name) + '</div>' +
                        (detailStr ? '<div class="player-chip-detail">' + escapeHtml(detailStr) + '</div>' : '') +
                    '</div>' +
                    '<button type="button" class="player-chip-remove" data-index="' + index + '">√ó</button>' +
                '</div>';
            }).join('');

            // Add remove handlers
            listEl.querySelectorAll('.player-chip-remove').forEach(function(btn) {
                btn.addEventListener('click', function() {
                    playersArray.splice(parseInt(this.dataset.index), 1);
                    renderPlayersList();
                });
            });
        }

        document.getElementById('btnAddPlayer').addEventListener('click', function() {
            const nameInput = document.getElementById('playerName');
            const companyInput = document.getElementById('playerCompany');
            const emailInput = document.getElementById('playerEmail');

            const name = nameInput.value.trim();
            if (!name) {
                nameInput.style.borderColor = '#dc3545';
                setTimeout(function() { nameInput.style.borderColor = '#e0e0e0'; }, 2000);
                return;
            }

            const newPlayer = {
                name: name,
                company: companyInput.value.trim(),
                email: emailInput.value.trim()
            };

            playersArray.push(newPlayer);

            // Save this player to the directory (update if already exists)
            const existingIndex = savedPlayers.findIndex(function(p) {
                return p.name.toLowerCase() === name.toLowerCase();
            });
            if (existingIndex >= 0) {
                // Update existing player's info (company/email may have changed)
                if (newPlayer.company) savedPlayers[existingIndex].company = newPlayer.company;
                if (newPlayer.email) savedPlayers[existingIndex].email = newPlayer.email;
            } else {
                savedPlayers.push(newPlayer);
            }
            saveData();  // Save the updated players directory to Firebase

            // Clear the inputs for the next person
            nameInput.value = '';
            companyInput.value = '';
            emailInput.value = '';
            nameInput.focus();

            // Close the player autocomplete dropdown
            document.getElementById('playerAutocompleteDropdown').classList.remove('active');

            renderPlayersList();
        });

        // ==========================================
        // PLAYER NAME AUTOCOMPLETE
        // Shows previously saved players as you type
        // ==========================================
        let playerAutocompleteTimeout = null;
        const playerNameInput = document.getElementById('playerName');
        const playerDropdown = document.getElementById('playerAutocompleteDropdown');

        playerNameInput.addEventListener('input', function() {
            const query = this.value.trim().toLowerCase();

            if (playerAutocompleteTimeout) clearTimeout(playerAutocompleteTimeout);

            if (query.length < 1) {
                playerDropdown.classList.remove('active');
                return;
            }

            playerAutocompleteTimeout = setTimeout(function() {
                // Filter saved players that match what's been typed
                const matches = savedPlayers.filter(function(player) {
                    return player.name.toLowerCase().includes(query);
                });

                if (matches.length === 0) {
                    playerDropdown.classList.remove('active');
                    return;
                }

                playerDropdown.classList.add('active');
                playerDropdown.innerHTML = matches.map(function(player) {
                    let detailParts = [];
                    if (player.company) detailParts.push(player.company);
                    if (player.email) detailParts.push(player.email);
                    const detailStr = detailParts.join(' ¬∑ ');
                    return '<div class="autocomplete-item player-autocomplete-item" ' +
                        'data-name="' + escapeHtml(player.name) + '" ' +
                        'data-company="' + escapeHtml(player.company || '') + '" ' +
                        'data-email="' + escapeHtml(player.email || '') + '">' +
                        '<div class="autocomplete-item-name">' + escapeHtml(player.name) + '</div>' +
                        (detailStr ? '<div class="autocomplete-item-location">' + escapeHtml(detailStr) + '</div>' : '') +
                    '</div>';
                }).join('');

                // Add click handlers to each suggestion
                playerDropdown.querySelectorAll('.player-autocomplete-item').forEach(function(item) {
                    item.addEventListener('click', function() {
                        document.getElementById('playerName').value = this.getAttribute('data-name');
                        document.getElementById('playerCompany').value = this.getAttribute('data-company');
                        document.getElementById('playerEmail').value = this.getAttribute('data-email');
                        playerDropdown.classList.remove('active');
                    });
                });
            }, 100);
        });

        // Close player dropdown when clicking outside
        playerNameInput.addEventListener('blur', function() {
            setTimeout(function() { playerDropdown.classList.remove('active'); }, 200);
        });

        // Let user press Enter in player fields to add
        ['playerName', 'playerCompany', 'playerEmail'].forEach(function(id) {
            document.getElementById(id).addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    document.getElementById('btnAddPlayer').click();
                }
            });
        });

        // ==========================================
        // PHOTO UPLOAD HANDLING
        // Converts photos to Base64 for storage in Firebase
        // ==========================================
        let photosArray = [];  // Stores Base64 photo strings for the current form

        function renderPhotosPreview() {
            const previewEl = document.getElementById('photosPreview');
            if (photosArray.length === 0) {
                previewEl.innerHTML = '';
                return;
            }
            previewEl.innerHTML = photosArray.map(function(photoData, index) {
                return '<div class="photo-thumb-container">' +
                    '<img class="photo-thumb" src="' + photoData + '" onclick="showPhotoViewer(\'' + index + '_form\')" />' +
                    '<button type="button" class="photo-thumb-remove" data-index="' + index + '">√ó</button>' +
                '</div>';
            }).join('');

            // Add remove handlers
            previewEl.querySelectorAll('.photo-thumb-remove').forEach(function(btn) {
                btn.addEventListener('click', function() {
                    photosArray.splice(parseInt(this.dataset.index), 1);
                    renderPhotosPreview();
                });
            });
        }

        // Handle file selection
        document.getElementById('photoInput').addEventListener('change', function(e) {
            const files = Array.from(e.target.files);
            
            files.forEach(function(file) {
                // No file size check here ‚Äî we compress first, then it'll be small enough

                // Convert to Base64
                const reader = new FileReader();
                reader.onload = function(event) {
                    // Resize the image to save space
                    const img = new Image();
                    img.onload = function() {
                        const canvas = document.createElement('canvas');
                        let width = img.width;
                        let height = img.height;

                        // Scale down to max 800px on longest side
                        // This keeps photos looking good while staying small
                        const maxSize = 800;
                        if (width > maxSize || height > maxSize) {
                            if (width > height) {
                                height = Math.round(height * maxSize / width);
                                width = maxSize;
                            } else {
                                width = Math.round(width * maxSize / height);
                                height = maxSize;
                            }
                        }

                        canvas.width = width;
                        canvas.height = height;
                        canvas.getContext('2d').drawImage(img, 0, 0, width, height);

                        // Compress as JPEG at 50% quality (good balance of quality vs size)
                        var compressed = canvas.toDataURL('image/jpeg', 0.5);
                        
                        // If still too large (over ~500KB as Base64), compress more
                        if (compressed.length > 700000) {
                            compressed = canvas.toDataURL('image/jpeg', 0.3);
                        }
                        
                        photosArray.push(compressed);
                        renderPhotosPreview();
                    };
                    img.src = event.target.result;
                };
                reader.readAsDataURL(file);
            });

            // Reset the input so the same file can be selected again
            this.value = '';
        });

        // Show full-size photo viewer
        function showPhotoViewer(idStr) {
            const parts = idStr.split('_');
            const index = parseInt(parts[0]);
            const source = parts[1];  // 'form' or 'detail'

            let src = '';
            if (source === 'form') {
                src = photosArray[index];
            } else if (source === 'detail') {
                // Get from the detail modal image
                src = document.querySelectorAll('.detail-photo')[index].src;
            }

            if (src) {
                document.getElementById('photoViewerImg').src = src;
                document.getElementById('photoViewer').classList.add('active');
            }
        }

        // ==========================================
        // RATING OPTION STYLING
        // Makes rating/option boxes highlight when you click them
        // ==========================================
        document.querySelectorAll('.rating-option, .list-type-option').forEach(option => {
            option.addEventListener('click', function() {
                const radioName = this.querySelector('input[type="radio"]').name;
                // Remove highlight from all options with the same name
                document.querySelectorAll(`input[name="${radioName}"]`).forEach(radio => {
                    radio.closest('.rating-option, .list-type-option').classList.remove('selected');
                });
                // Add highlight to the clicked option
                this.classList.add('selected');
                this.querySelector('input[type="radio"]').checked = true;
                
                // If this is the Wishlist/Played toggle, switch the form fields
                if (radioName === 'listType') {
                    const selectedValue = this.querySelector('input[type="radio"]').value;
                    if (selectedValue === 'wishlist') {
                        showWishlistFields();
                    } else {
                        showPlayedFields();
                    }
                }
            });
        });

        // ==========================================
        // COURSE NAME INPUT HANDLER
        // Only auto-fills when you select from dropdown, not while typing
        // ==========================================
        let addressTimeout;
        let websiteTimeout;
        
        // We've removed the auto-fill on typing
        // Address/website will only fill when you select a course from the dropdown

        // ==========================================
        // FORM SUBMISSION - ADDING A NEW COURSE
        // When you click "Add Course" button, this saves to the right list
        // ==========================================
        console.log('Setting up form submit handler...');
        document.getElementById('courseForm').addEventListener('submit', function(e) {
            console.log('Form submitted!');
            e.preventDefault();
            
            const listType = document.querySelector('input[name="listType"]:checked').value;
            const courseName = document.getElementById('courseName').value;
            
            // Get shared location fields
            const address = document.getElementById('address').value;
            const city = document.getElementById('city').value;
            const state = document.getElementById('state').value;
            const country = document.getElementById('country').value;
            const website = document.getElementById('website').value;
            
            if (listType === 'wishlist') {
                // Add to wish list
                const newCourse = {
                    id: (editingId && editingType === 'wishlist') ? editingId : Date.now(),
                    name: courseName,
                    address: address,
                    city: city,
                    state: state,
                    country: country,
                    website: website,
                    heardFrom: document.getElementById('heardFrom').value,
                    rating: document.querySelector('input[name="rating"]:checked')?.value || '',
                    notes: document.getElementById('wishlistNotes').value,
                    dateAdded: new Date().toISOString()
                };
                
                if (editingId && editingType === 'wishlist') {
                    // Replace existing entry
                    const idx = wishlistCourses.findIndex(function(c) { return c.id === editingId; });
                    if (idx >= 0) {
                        wishlistCourses[idx] = newCourse;
                    } else {
                        wishlistCourses.push(newCourse);
                    }
                } else {
                    wishlistCourses.push(newCourse);
                }
                renderWishList();
            } else {
                // Add to played list
                const newRound = {
                    id: (editingId && editingType === 'played') ? editingId : Date.now(),
                    name: courseName,
                    address: address,
                    city: city,
                    state: state,
                    country: country,
                    website: website,
                    datePlayed: document.getElementById('datePlayed').value,
                    holes: document.querySelector('input[name="holes"]:checked')?.value || '18',
                    playedWith: playersArray.slice(),
                    score: document.getElementById('score').value,
                    notes: document.getElementById('playedNotes').value,
                    photos: photosArray.slice()
                };
                
                if (editingId && editingType === 'played') {
                    // Replace existing entry
                    const idx = playedCourses.findIndex(function(r) { return r.id === editingId; });
                    if (idx >= 0) {
                        playedCourses[idx] = newRound;
                    } else {
                        playedCourses.push(newRound);
                    }
                } else {
                    playedCourses.push(newRound);
                }
                renderPlayedList();
                
                // Check if this was moved from wishlist
                const wishlistId = sessionStorage.getItem('moveFromWishlist');
                if (wishlistId) {
                    // Ask if they want to remove from wish list
                    if (confirm(`"${courseName}" has been added to your played list!\n\nDo you want to remove it from your wish list?`)) {
                        wishlistCourses = wishlistCourses.filter(c => c.id !== parseInt(wishlistId));
                        renderWishList();
                    }
                    sessionStorage.removeItem('moveFromWishlist');
                }
            }
            
            saveData();
            this.reset();
            
            // Clear editing state
            editingId = null;
            editingType = null;
            document.getElementById('btnSubmitCourse').textContent = 'Add Course';
            document.getElementById('btnDeleteFromForm').style.display = 'none';
            
            // Clear the players list
            playersArray = [];
            renderPlayersList();
            
            // Clear photos
            photosArray = [];
            renderPhotosPreview();
            
            // Remove all highlights
            document.querySelectorAll('.rating-option, .list-type-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            
            // Reset to wishlist view
            document.getElementById('btnShowWishList').click();
            showWishlistFields();
        });

        // ==========================================
        // DISPLAY WISH LIST
        // Shows all courses you want to play
        // ==========================================
        // ==========================================
        // GOLF DIGEST RANKINGS DATABASE
        // 2025-2026 America's 100 Greatest + Top 100 Public
        // Used to show ranking badges on wishlist cards
        // ==========================================
        const golfDigestRankings = [
            // America's 100 Greatest (2025-2026)
            {name:"Pine Valley Golf Club",rank:1,list:"Top 100"},
            {name:"Augusta National Golf Club",rank:2,list:"Top 100"},
            {name:"Cypress Point Club",rank:3,list:"Top 100"},
            {name:"Shinnecock Hills Golf Club",rank:4,list:"Top 100"},
            {name:"Oakmont Country Club",rank:5,list:"Top 100"},
            {name:"Merion Golf Club",rank:6,list:"Top 100"},
            {name:"National Golf Links of America",rank:7,list:"Top 100"},
            {name:"Sand Hills Golf Club",rank:8,list:"Top 100"},
            {name:"Pebble Beach Golf Links",rank:9,list:"Top 100"},
            {name:"Fishers Island Club",rank:10,list:"Top 100"},
            {name:"Chicago Golf Club",rank:11,list:"Top 100"},
            {name:"Pinehurst No. 2",rank:12,list:"Top 100"},
            {name:"Winged Foot Golf Club",rank:13,list:"Top 100"},
            {name:"Seminole Golf Club",rank:14,list:"Top 100"},
            {name:"Streamsong Resort Red",rank:15,list:"Top 100 Public"},
            {name:"Crystal Downs Country Club",rank:16,list:"Top 100"},
            {name:"The Country Club",rank:17,list:"Top 100"},
            {name:"Prairie Dunes Country Club",rank:18,list:"Top 100"},
            {name:"Garden City Golf Club",rank:19,list:"Top 100"},
            {name:"Los Angeles Country Club",rank:20,list:"Top 100"},
            {name:"Oak Hill Country Club",rank:21,list:"Top 100"},
            {name:"Riviera Country Club",rank:22,list:"Top 100"},
            {name:"Pacific Dunes",rank:23,list:"Top 100"},
            {name:"Bandon Dunes Pacific Dunes",rank:23,list:"Top 100"},
            {name:"Shadow Creek Golf Course",rank:24,list:"Top 100"},
            {name:"Camargo Club",rank:25,list:"Top 100"},
            {name:"Whistling Straits",rank:26,list:"Top 100"},
            {name:"The Straits Course at Whistling Straits",rank:26,list:"Top 100"},
            {name:"Olympic Club",rank:27,list:"Top 100"},
            {name:"San Francisco Golf Club",rank:28,list:"Top 100"},
            {name:"Friar's Head",rank:29,list:"Top 100"},
            {name:"The Ocean Course at Kiawah Island",rank:30,list:"Top 100"},
            {name:"Kiawah Island Ocean Course",rank:30,list:"Top 100"},
            {name:"Southern Hills Country Club",rank:31,list:"Top 100"},
            {name:"Somerset Hills Country Club",rank:32,list:"Top 100"},
            {name:"Oakland Hills Country Club",rank:33,list:"Top 100"},
            {name:"Shoreacres",rank:34,list:"Top 100"},
            {name:"Bethpage Black",rank:38,list:"Top 100"},
            {name:"Bethpage State Park Golf Course",rank:38,list:"Top 100"},
            {name:"TPC Sawgrass",rank:41,list:"Top 100"},
            {name:"TPC Sawgrass Stadium Course",rank:41,list:"Top 100"},
            {name:"Baltusrol Golf Club",rank:42,list:"Top 100"},
            {name:"Bandon Dunes",rank:44,list:"Top 100"},
            {name:"Bandon Dunes Golf Resort",rank:44,list:"Top 100"},
            {name:"Erin Hills",rank:49,list:"Top 100"},
            {name:"Erin Hills Golf Course",rank:49,list:"Top 100"},
            {name:"Sleepy Hollow Country Club",rank:52,list:"Top 100"},
            {name:"Maidstone Club",rank:53,list:"Top 100"},
            {name:"Myopia Hunt Club",rank:54,list:"Top 100"},
            {name:"Bandon Trails",rank:61,list:"Top 100"},
            {name:"Bandon Dunes Bandon Trails",rank:61,list:"Top 100"},
            {name:"Congressional Country Club",rank:67,list:"Top 100"},
            {name:"The Lido",rank:69,list:"Top 100"},
            {name:"Sand Valley The Lido",rank:69,list:"Top 100"},
            {name:"CapRock Ranch",rank:72,list:"Top 100"},
            {name:"Quaker Ridge Golf Club",rank:75,list:"Top 100"},
            {name:"Kinloch Golf Club",rank:79,list:"Top 100"},
            {name:"Old MacDonald",rank:81,list:"Top 100"},
            {name:"Bandon Dunes Old MacDonald",rank:81,list:"Top 100"},
            {name:"Ladera Golf Club",rank:83,list:"Top 100"},
            {name:"Canyata",rank:86,list:"Top 100"},
            {name:"Hudson National Golf Club",rank:88,list:"Top 100"},
            {name:"The Kittansett Club",rank:89,list:"Top 100"},
            {name:"Plainfield Country Club",rank:90,list:"Top 100"},
            {name:"Boston Golf Club",rank:91,list:"Top 100"},
            {name:"Valhalla Golf Club",rank:94,list:"Top 100"},
            {name:"Aronimink Golf Club",rank:100,list:"Top 100"},
            // Top 100 Greatest Public (2025-2026)
            {name:"Pebble Beach Golf Links",rank:1,list:"Top 100 Public"},
            {name:"Pacific Dunes",rank:2,list:"Top 100 Public"},
            {name:"Shadow Creek",rank:3,list:"Top 100 Public"},
            {name:"Whistling Straits",rank:4,list:"Top 100 Public"},
            {name:"Kiawah Island Ocean Course",rank:5,list:"Top 100 Public"},
            {name:"Pinehurst No. 2",rank:6,list:"Top 100 Public"},
            {name:"Bethpage Black",rank:7,list:"Top 100 Public"},
            {name:"TPC Sawgrass",rank:8,list:"Top 100 Public"},
            {name:"Bandon Dunes",rank:9,list:"Top 100 Public"},
            {name:"Erin Hills",rank:10,list:"Top 100 Public"},
            {name:"Bandon Trails",rank:11,list:"Top 100 Public"},
            {name:"The Lido",rank:12,list:"Top 100 Public"},
            {name:"Old MacDonald",rank:14,list:"Top 100 Public"},
            {name:"Blackwolf Run River Course",rank:17,list:"Top 100 Public"},
            {name:"The River Course at Blackwolf Run",rank:17,list:"Top 100 Public"},
            {name:"Streamsong Red",rank:20,list:"Top 100 Public"},
            {name:"Sand Valley",rank:21,list:"Top 100 Public"},
            {name:"Sand Valley Golf Resort",rank:21,list:"Top 100 Public"},
            {name:"Kapalua Plantation Course",rank:23,list:"Top 100 Public"},
            {name:"Kapalua Golf",rank:23,list:"Top 100 Public"},
            {name:"Mammoth Dunes",rank:25,list:"Top 100 Public"},
            {name:"Sand Valley Mammoth Dunes",rank:25,list:"Top 100 Public"},
            {name:"Streamsong Blue",rank:26,list:"Top 100 Public"},
            {name:"Sheep Ranch",rank:27,list:"Top 100 Public"},
            {name:"Bandon Dunes Sheep Ranch",rank:27,list:"Top 100 Public"},
            {name:"Harbour Town Golf Links",rank:28,list:"Top 100 Public"},
            {name:"Primland Highland Course",rank:29,list:"Top 100 Public"},
            {name:"Streamsong Black",rank:33,list:"Top 100 Public"},
            {name:"Prairie Club Dunes",rank:36,list:"Top 100 Public"},
            {name:"Yale Golf Course",rank:38,list:"Top 100 Public"},
            {name:"Omni Homestead Cascades",rank:42,list:"Top 100 Public"},
            {name:"Tobacco Road",rank:44,list:"Top 100 Public"},
            {name:"Tobacco Road Golf Club",rank:44,list:"Top 100 Public"},
            {name:"SentryWorld",rank:49,list:"Top 100 Public"},
            {name:"Wolf Creek Golf Club",rank:59,list:"Top 100 Public"},
            {name:"Pine Needles",rank:60,list:"Top 100 Public"},
            {name:"Pine Needles Lodge",rank:60,list:"Top 100 Public"},
            {name:"Irish Course at Whistling Straits",rank:65,list:"Top 100 Public"},
            {name:"Lawsonia Links",rank:66,list:"Top 100 Public"},
            {name:"Cascata Golf Club",rank:74,list:"Top 100 Public"},
            {name:"Golden Horseshoe Gold",rank:75,list:"Top 100 Public"},
            {name:"Taconic Golf Club",rank:78,list:"Top 100 Public"},
            {name:"Trump National Doral Blue Monster",rank:86,list:"Top 100 Public"},
            {name:"Mid Pines",rank:88,list:"Top 100 Public"},
            {name:"Mid Pines Inn",rank:88,list:"Top 100 Public"},
            {name:"The Park at West Palm Beach",rank:89,list:"Top 100 Public"},
            {name:"Blackwolf Run Meadow Valleys",rank:92,list:"Top 100 Public"},
            {name:"Prairie Club Pines",rank:90,list:"Top 100 Public"},
            {name:"Southern Pines Golf Club",rank:98,list:"Top 100 Public"}
        ];

        // Fuzzy match a course name against the rankings database
        function getGolfDigestRanking(courseName) {
            if (!courseName) return null;
            const search = courseName.toLowerCase().replace(/[^a-z0-9\s]/g, '').trim();
            
            let bestMatch = null;
            let bestScore = 0;
            
            golfDigestRankings.forEach(function(entry) {
                const entryName = entry.name.toLowerCase().replace(/[^a-z0-9\s]/g, '').trim();
                
                // Exact match
                if (search === entryName) {
                    if (!bestMatch || entry.rank < bestMatch.rank) {
                        bestMatch = entry;
                        bestScore = 100;
                    }
                    return;
                }
                
                // One contains the other
                if (search.includes(entryName) || entryName.includes(search)) {
                    const score = Math.min(search.length, entryName.length) / Math.max(search.length, entryName.length) * 90;
                    if (score > bestScore) {
                        bestMatch = entry;
                        bestScore = score;
                    }
                }
                
                // Check if key words match (for courses with alternate names)
                const searchWords = search.split(/\s+/);
                const entryWords = entryName.split(/\s+/);
                const matchingWords = searchWords.filter(function(w) {
                    return w.length > 2 && entryWords.some(function(ew) { return ew.includes(w) || w.includes(ew); });
                });
                const wordScore = matchingWords.length / Math.max(searchWords.length, entryWords.length) * 80;
                if (wordScore > bestScore && wordScore > 50) {
                    bestMatch = entry;
                    bestScore = wordScore;
                }
            });
            
            return bestScore > 40 ? bestMatch : null;
        }

        // ==========================================
        // SORT & FILTER STATE
        // ==========================================
        let wishSortMode = 'alpha';
        let playedSortMode = 'alpha';
        let wishMapLevel = 'country'; // country, state, city
        let playedMapLevel = 'country';
        let wishMapSelection = { country: '', state: '' };
        let playedMapSelection = { country: '', state: '' };

        // Country flag emoji lookup
        const countryFlags = {
            'USA': 'üá∫üá∏', 'United States': 'üá∫üá∏', 'United States of America': 'üá∫üá∏',
            'Canada': 'üá®üá¶', 'Scotland': 'üè¥Û†ÅßÛ†Å¢Û†Å≥Û†Å£Û†Å¥Û†Åø', 'England': 'üè¥Û†ÅßÛ†Å¢Û†Å•Û†ÅÆÛ†ÅßÛ†Åø',
            'Ireland': 'üáÆüá™', 'Northern Ireland': 'üá¨üáß', 'UK': 'üá¨üáß', 'United Kingdom': 'üá¨üáß',
            'UAE': 'üá¶üá™', 'Australia': 'üá¶üá∫', 'New Zealand': 'üá≥üáø', 'Japan': 'üáØüáµ',
            'Mexico': 'üá≤üáΩ', 'Spain': 'üá™üá∏', 'France': 'üá´üá∑', 'Portugal': 'üáµüáπ',
            'Germany': 'üá©üá™', 'Italy': 'üáÆüáπ', 'South Korea': 'üá∞üá∑', 'Thailand': 'üáπüá≠',
            'Dominican Republic': 'üá©üá¥', 'Bahamas': 'üáßüá∏', 'Bermuda': 'üáßüá≤',
            'South Africa': 'üáøüá¶', 'Saint Lucia': 'üá±üá®'
        };

        function getFlag(country) {
            return countryFlags[country] || 'üåç';
        }

        // Sort button click handlers
        document.addEventListener('click', function(e) {
            if (!e.target.classList.contains('sort-btn')) return;
            const list = e.target.dataset.list;
            const sort = e.target.dataset.sort;
            
            e.target.closest('.sort-buttons').querySelectorAll('.sort-btn').forEach(b => b.classList.remove('active'));
            e.target.classList.add('active');
            
            if (list === 'wish') {
                wishSortMode = sort;
                wishMapLevel = 'country';
                wishMapSelection = { country: '', state: '' };
                document.getElementById('wishMapView').style.display = sort === 'map' ? 'block' : 'none';
                renderWishList();
                if (sort === 'map') renderMapView('wish');
            } else {
                playedSortMode = sort;
                playedMapLevel = 'country';
                playedMapSelection = { country: '', state: '' };
                document.getElementById('playedMapView').style.display = sort === 'map' ? 'block' : 'none';
                renderPlayedList();
                if (sort === 'map') renderMapView('played');
            }
        });

        function getCoursesForList(listType) {
            if (listType === 'wish') return wishlistCourses;
            // For played, return one entry per unique course name (using most recent round)
            const groups = {};
            playedCourses.forEach(r => {
                if (!groups[r.name]) groups[r.name] = [];
                groups[r.name].push(r);
            });
            return Object.values(groups).map(rounds => {
                rounds.sort((a, b) => new Date(b.datePlayed) - new Date(a.datePlayed));
                return rounds[0];
            });
        }

        function renderMapView(listType) {
            const mapEl = document.getElementById(listType + 'MapView');
            const courses = getCoursesForList(listType);
            const level = listType === 'wish' ? wishMapLevel : playedMapLevel;
            const selection = listType === 'wish' ? wishMapSelection : playedMapSelection;
            
            if (courses.length === 0) {
                mapEl.innerHTML = '';
                return;
            }

            let html = '';
            
            // Breadcrumb navigation
            html += '<div class="map-breadcrumb">';
            html += `<span class="map-breadcrumb-item" onclick="mapNavigate('${listType}', 'country', '', '')">üåç World</span>`;
            if (selection.country) {
                html += '<span class="map-breadcrumb-separator">‚Ä∫</span>';
                if (level === 'state' || level === 'city') {
                    html += `<span class="map-breadcrumb-item" onclick="mapNavigate('${listType}', 'state', '${escapeHtml(selection.country)}', '')">${getFlag(selection.country)} ${escapeHtml(selection.country)}</span>`;
                }
                if (selection.state && level === 'city') {
                    html += '<span class="map-breadcrumb-separator">‚Ä∫</span>';
                    html += `<span class="map-breadcrumb-current">üìç ${escapeHtml(selection.state)}</span>`;
                }
            }
            html += '</div>';

            if (level === 'country') {
                // Show countries as cards with globe
                const countryCounts = {};
                courses.forEach(c => {
                    const country = (c.country || 'Unknown').trim();
                    countryCounts[country] = (countryCounts[country] || 0) + 1;
                });
                
                // Globe SVG
                html += '<div class="map-globe-container">';
                html += buildGlobeSVG(Object.keys(countryCounts));
                html += '</div>';
                
                html += '<div class="map-region-grid">';
                Object.keys(countryCounts).sort().forEach(country => {
                    html += `
                        <div class="map-region-card" onclick="mapNavigate('${listType}', 'state', '${escapeHtml(country)}', '')">
                            <div class="map-region-flag">${getFlag(country)}</div>
                            <div class="map-region-name">${escapeHtml(country)}</div>
                            <div class="map-region-count">${countryCounts[country]} course${countryCounts[country] > 1 ? 's' : ''}</div>
                        </div>
                    `;
                });
                html += '</div>';
                
            } else if (level === 'state') {
                // Show states/provinces for selected country
                const filtered = courses.filter(c => (c.country || '').trim() === selection.country);
                const stateCounts = {};
                filtered.forEach(c => {
                    const state = (c.state || 'Unknown').trim();
                    stateCounts[state] = (stateCounts[state] || 0) + 1;
                });
                
                html += '<div class="map-region-grid">';
                Object.keys(stateCounts).sort().forEach(state => {
                    html += `
                        <div class="map-region-card" onclick="mapNavigate('${listType}', 'city', '${escapeHtml(selection.country)}', '${escapeHtml(state)}')">
                            <div class="map-region-flag">üìç</div>
                            <div class="map-region-name">${escapeHtml(state)}</div>
                            <div class="map-region-count">${stateCounts[state]} course${stateCounts[state] > 1 ? 's' : ''}</div>
                        </div>
                    `;
                });
                html += '</div>';
                
            } else if (level === 'city') {
                // Show cities for selected state ‚Äî these just filter the list below
                const filtered = courses.filter(c => 
                    (c.country || '').trim() === selection.country && 
                    (c.state || '').trim() === selection.state
                );
                const cityCounts = {};
                filtered.forEach(c => {
                    const city = (c.city || 'Unknown').trim();
                    cityCounts[city] = (cityCounts[city] || 0) + 1;
                });
                
                if (Object.keys(cityCounts).length > 1) {
                    html += '<div class="map-region-grid">';
                    Object.keys(cityCounts).sort().forEach(city => {
                        html += `
                            <div class="map-region-card" style="padding: 8px;">
                                <div class="map-region-name" style="font-size: 13px;">${escapeHtml(city)}</div>
                                <div class="map-region-count">${cityCounts[city]} course${cityCounts[city] > 1 ? 's' : ''}</div>
                            </div>
                        `;
                    });
                    html += '</div>';
                }
            }
            
            mapEl.innerHTML = html;
        }

        // Globe SVG with highlighted countries
        function buildGlobeSVG(activeCountries) {
            // Simple world regions as approximate SVG paths
            // Each region represents a rough continental/country area
            const regions = {
                'North America': { cx: 120, cy: 100, r: 40, countries: ['USA', 'United States', 'United States of America', 'Canada', 'Mexico', 'Bahamas', 'Bermuda', 'Dominican Republic'] },
                'Europe': { cx: 280, cy: 80, r: 30, countries: ['England', 'Scotland', 'Ireland', 'Northern Ireland', 'UK', 'United Kingdom', 'France', 'Spain', 'Portugal', 'Germany', 'Italy'] },
                'Africa': { cx: 280, cy: 160, r: 35, countries: ['South Africa'] },
                'Middle East': { cx: 320, cy: 110, r: 18, countries: ['UAE'] },
                'Asia': { cx: 380, cy: 95, r: 35, countries: ['Japan', 'South Korea', 'Thailand', 'China', 'India'] },
                'Oceania': { cx: 420, cy: 180, r: 25, countries: ['Australia', 'New Zealand'] },
                'Caribbean': { cx: 150, cy: 140, r: 15, countries: ['Saint Lucia', 'Dominican Republic', 'Bahamas'] }
            };
            
            const activeSet = new Set(activeCountries);
            
            let svg = `<svg viewBox="0 0 500 240" style="max-width: 400px; width: 100%;">`;
            // Ocean background
            svg += `<rect x="0" y="0" width="500" height="240" rx="12" fill="#e8f0fe" />`;
            // Grid lines
            for (let x = 50; x < 500; x += 50) {
                svg += `<line x1="${x}" y1="0" x2="${x}" y2="240" stroke="#d0dff0" stroke-width="0.5" />`;
            }
            for (let y = 40; y < 240; y += 40) {
                svg += `<line x1="0" y1="${y}" x2="500" y2="${y}" stroke="#d0dff0" stroke-width="0.5" />`;
            }
            
            // Draw each region
            Object.entries(regions).forEach(([name, region]) => {
                const hasActive = region.countries.some(c => activeSet.has(c));
                const fill = hasActive ? '#2c5f2d' : '#c8d8c8';
                const opacity = hasActive ? '0.85' : '0.4';
                // Use ellipses for continent shapes
                const rx = region.r * 1.3;
                const ry = region.r * 0.9;
                svg += `<ellipse cx="${region.cx}" cy="${region.cy}" rx="${rx}" ry="${ry}" fill="${fill}" opacity="${opacity}" />`;
                if (hasActive) {
                    // Count courses
                    const count = activeCountries.filter(c => region.countries.includes(c)).length;
                    svg += `<text x="${region.cx}" y="${region.cy - 2}" text-anchor="middle" fill="white" font-size="9" font-weight="bold">${name}</text>`;
                    svg += `<text x="${region.cx}" y="${region.cy + 10}" text-anchor="middle" fill="white" font-size="8">${count} ${count === 1 ? 'country' : 'countries'}</text>`;
                }
            });
            
            svg += `</svg>`;
            return svg;
        }

        // Map navigation handler
        window.mapNavigate = function(listType, level, country, state) {
            if (listType === 'wish') {
                wishMapLevel = level;
                wishMapSelection = { country, state };
                renderMapView('wish');
                renderWishList();
            } else {
                playedMapLevel = level;
                playedMapSelection = { country, state };
                renderMapView('played');
                renderPlayedList();
            }
        };

        // ==========================================
        // DISPLAY WISH LIST
        // ==========================================
        function renderWishList() {
            const listEl = document.getElementById('wishList');
            const sortControls = document.getElementById('wishListSortControls');
            
            if (wishlistCourses.length === 0) {
                sortControls.style.display = 'none';
                document.getElementById('wishMapView').style.display = 'none';
                listEl.innerHTML = `
                    <div class="card empty-state">
                        <div class="empty-state-icon">‚õ≥</div>
                        <p>No courses on your wish list yet!</p>
                        <p style="margin-top: 8px; font-size: 14px;">Click "Add" to add courses you want to play.</p>
                    </div>
                `;
                return;
            }
            
            if (document.getElementById('wishListContainer').classList.contains('active')) {
                sortControls.style.display = 'flex';
            }
            
            const ratingLabels = { must: 'Must Play', would: 'Would Like', nearby: 'If Nearby' };
            const ratingClasses = { must: 'rating-must', would: 'rating-would', nearby: 'rating-nearby' };
            const ratingOrder = { must: 0, would: 1, nearby: 2, '': 3 };
            
            let courses = [...wishlistCourses];
            
            // Apply map filter if in map mode
            if (wishSortMode === 'map') {
                if (wishMapSelection.country) {
                    courses = courses.filter(c => (c.country || '').trim() === wishMapSelection.country);
                }
                if (wishMapSelection.state) {
                    courses = courses.filter(c => (c.state || '').trim() === wishMapSelection.state);
                }
            }
            
            // Sort
            if (wishSortMode === 'alpha' || wishSortMode === 'map') {
                courses.sort((a, b) => a.name.localeCompare(b.name));
            } else if (wishSortMode === 'state') {
                courses.sort((a, b) => {
                    const ca = (a.country || 'ZZZ').trim();
                    const cb = (b.country || 'ZZZ').trim();
                    if (ca !== cb) return ca.localeCompare(cb);
                    const sa = (a.state || 'ZZZ').trim();
                    const sb = (b.state || 'ZZZ').trim();
                    if (sa !== sb) return sa.localeCompare(sb);
                    return a.name.localeCompare(b.name);
                });
            } else if (wishSortMode === 'rating') {
                courses.sort((a, b) => {
                    const ra = ratingOrder[a.rating || ''];
                    const rb = ratingOrder[b.rating || ''];
                    if (ra !== rb) return ra - rb;
                    return a.name.localeCompare(b.name);
                });
            }
            
            let html = '';
            let currentGroup = null;
            
            courses.forEach(course => {
                if (wishSortMode === 'state') {
                    const group = [(course.country || '').trim(), (course.state || '').trim()].filter(Boolean).join(' ‚Ä∫ ') || 'Unknown';
                    if (group !== currentGroup) {
                        currentGroup = group;
                        const flag = getFlag((course.country || '').trim());
                        html += `<div class="state-group-header">${flag} ${escapeHtml(group)}</div>`;
                    }
                }
                if (wishSortMode === 'rating') {
                    const group = course.rating || '';
                    if (group !== currentGroup) {
                        currentGroup = group;
                        html += `<div class="state-group-header">${group ? ratingLabels[group] : 'Unrated'}</div>`;
                    }
                }
                
                let locationStr = '';
                if (course.city || course.state || course.country) {
                    const parts = [];
                    if (course.city) parts.push(course.city);
                    if (course.state) parts.push(course.state);
                    if (course.country) parts.push(course.country);
                    locationStr = parts.join(', ');
                }
                
                const gdRank = getGolfDigestRanking(course.name);

                html += `
                    <div class="course-item" data-id="${course.id}" data-type="wishlist">
                        <div class="course-header">
                            <div class="course-name-area" style="flex: 1; min-width: 0;">
                                <div class="course-name">${course.name}</div>
                                ${locationStr ? `<a class="course-location map-link" href="https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(course.name + ' ' + locationStr)}" target="_blank" onclick="event.stopPropagation();">üìç ${locationStr}</a>` : ''}
                                ${course.website ? `<a class="course-website-link" href="${course.website}" target="_blank" onclick="event.stopPropagation();">üåê ${course.website.replace(/^https?:\/\/(www\.)?/, '').replace(/\/$/, '')}</a>` : ''}
                                ${course.heardFrom ? `<div class="course-source">via ${course.heardFrom}</div>` : ''}
                            </div>
                            <div style="display: flex; align-items: center; gap: 8px; flex-shrink: 0;">
                                ${course.rating ? `<div class="course-rating ${ratingClasses[course.rating]}">${ratingLabels[course.rating]}</div>` : ''}
                                ${gdRank ? `<div class="gd-ranking" onclick="event.stopPropagation();">
                                    <div class="gd-ranking-label">Golf Digest</div>
                                    <div class="gd-ranking-number">#${gdRank.rank}</div>
                                    <div class="gd-ranking-list">${gdRank.list}</div>
                                </div>` : ''}
                            </div>
                        </div>
                    </div>
                `;
            });
            
            if (wishSortMode === 'map' && courses.length === 0 && wishlistCourses.length > 0) {
                html += '<div class="card empty-state" style="padding:16px; text-align:center;"><p>No courses in this location. Select a region above.</p></div>';
            }
            
            listEl.innerHTML = html;
            
            document.querySelectorAll('#wishList .course-item').forEach(item => {
                item.addEventListener('click', function() {
                    showCourseDetail(parseInt(this.dataset.id), 'wishlist');
                });
            });
        }

        // ==========================================
        // DISPLAY PLAYED LIST
        // ==========================================
        function renderPlayedList() {
            const listEl = document.getElementById('playedList');
            const sortControls = document.getElementById('playedListSortControls');
            
            if (playedCourses.length === 0) {
                sortControls.style.display = 'none';
                document.getElementById('playedMapView').style.display = 'none';
                listEl.innerHTML = `
                    <div class="card empty-state">
                        <div class="empty-state-icon">‚úÖ</div>
                        <p>No rounds recorded yet!</p>
                        <p style="margin-top: 8px; font-size: 14px;">Click "Add" to log courses you've played.</p>
                    </div>
                `;
                return;
            }
            
            if (document.getElementById('playedListContainer').classList.contains('active')) {
                sortControls.style.display = 'flex';
            }
            
            // Group rounds by course name
            const courseGroups = {};
            playedCourses.forEach(round => {
                if (!courseGroups[round.name]) courseGroups[round.name] = [];
                courseGroups[round.name].push(round);
            });
            
            Object.keys(courseGroups).forEach(name => {
                courseGroups[name].sort((a, b) => new Date(b.datePlayed) - new Date(a.datePlayed));
            });
            
            let entries = Object.keys(courseGroups).map(courseName => {
                const rounds = courseGroups[courseName];
                return { courseName, rounds, mostRecent: rounds[0] };
            });
            
            // Apply map filter
            if (playedSortMode === 'map') {
                if (playedMapSelection.country) {
                    entries = entries.filter(e => (e.mostRecent.country || '').trim() === playedMapSelection.country);
                }
                if (playedMapSelection.state) {
                    entries = entries.filter(e => (e.mostRecent.state || '').trim() === playedMapSelection.state);
                }
            }
            
            // Sort
            if (playedSortMode === 'alpha' || playedSortMode === 'map') {
                entries.sort((a, b) => a.courseName.localeCompare(b.courseName));
            } else if (playedSortMode === 'state') {
                entries.sort((a, b) => {
                    const ca = (a.mostRecent.country || 'ZZZ').trim();
                    const cb = (b.mostRecent.country || 'ZZZ').trim();
                    if (ca !== cb) return ca.localeCompare(cb);
                    const sa = (a.mostRecent.state || 'ZZZ').trim();
                    const sb = (b.mostRecent.state || 'ZZZ').trim();
                    if (sa !== sb) return sa.localeCompare(sb);
                    return a.courseName.localeCompare(b.courseName);
                });
            } else if (playedSortMode === 'score') {
                entries.sort((a, b) => {
                    const sa = parseInt(a.mostRecent.score) || 999;
                    const sb = parseInt(b.mostRecent.score) || 999;
                    if (sa !== sb) return sa - sb;
                    return a.courseName.localeCompare(b.courseName);
                });
            }
            
            let html = '';
            let currentGroup = null;
            
            entries.forEach(({ courseName, rounds, mostRecent }) => {
                const timesPlayed = rounds.length;
                
                if (playedSortMode === 'state') {
                    const group = [(mostRecent.country || '').trim(), (mostRecent.state || '').trim()].filter(Boolean).join(' ‚Ä∫ ') || 'Unknown';
                    if (group !== currentGroup) {
                        currentGroup = group;
                        const flag = getFlag((mostRecent.country || '').trim());
                        html += `<div class="state-group-header">${flag} ${escapeHtml(group)}</div>`;
                    }
                }
                if (playedSortMode === 'score') {
                    const scoreGroup = mostRecent.score ? 'Score: ' + mostRecent.score : 'No Score Recorded';
                    // Don't group by individual scores ‚Äî just sort
                }
                
                let locationStr = '';
                if (mostRecent.city || mostRecent.state || mostRecent.country) {
                    const parts = [];
                    if (mostRecent.city) parts.push(mostRecent.city);
                    if (mostRecent.state) parts.push(mostRecent.state);
                    if (mostRecent.country) parts.push(mostRecent.country);
                    locationStr = parts.join(', ');
                }
                
                html += `
                    <div class="course-item" data-id="${mostRecent.id}" data-type="played" data-course-name="${escapeHtml(courseName)}">
                        <div class="course-header">
                            <div class="course-name">${escapeHtml(courseName)} <span style="font-size: 13px; font-weight: 400; color: #666;">üìÖ ${new Date(mostRecent.datePlayed).toLocaleDateString()}</span></div>
                            <div style="display: flex; gap: 6px;">
                                ${mostRecent.score ? `<div class="times-played-badge">üèåÔ∏è ${mostRecent.score}</div>` : ''}
                                ${timesPlayed > 1 ? `<div class="times-played-badge">${timesPlayed}x</div>` : ''}
                            </div>
                        </div>
                        ${(() => {
                            let playedWithStr = '';
                            if (Array.isArray(mostRecent.playedWith) && mostRecent.playedWith.length > 0) {
                                playedWithStr = mostRecent.playedWith.map(p => p.name).join(', ');
                            } else if (typeof mostRecent.playedWith === 'string' && mostRecent.playedWith) {
                                playedWithStr = mostRecent.playedWith;
                            }
                            return playedWithStr ? `<div class="course-location">üë• ${playedWithStr}</div>` : '';
                        })()}
                        ${locationStr ? `<a class="course-source map-link" href="https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(courseName + ' ' + locationStr)}" target="_blank" onclick="event.stopPropagation();">üìç ${locationStr}</a>` : ''}
                        ${(() => {
                            let allPhotos = [];
                            rounds.forEach(function(r) {
                                if (Array.isArray(r.photos)) allPhotos = allPhotos.concat(r.photos);
                            });
                            if (allPhotos.length === 0) return '';
                            let shuffled = allPhotos.slice();
                            for (let i = shuffled.length - 1; i > 0; i--) {
                                const j = Math.floor(Math.random() * (i + 1));
                                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
                            }
                            const shown = shuffled.slice(0, 4);
                            const extra = allPhotos.length - shown.length;
                            return '<div class="list-photo-strip">' +
                                shown.map(p => '<img class="list-photo-thumb" src="' + p + '" />').join('') +
                                (extra > 0 ? '<div class="list-photo-more">+' + extra + '</div>' : '') +
                            '</div>';
                        })()}
                    </div>
                `;
            });
            
            if (playedSortMode === 'map' && entries.length === 0 && playedCourses.length > 0) {
                html += '<div class="card empty-state" style="padding:16px; text-align:center;"><p>No courses in this location. Select a region above.</p></div>';
            }
            
            listEl.innerHTML = html;
            
            document.querySelectorAll('#playedList .course-item').forEach(item => {
                item.addEventListener('click', function() {
                    showPlayedCourseRounds(this.dataset.courseName);
                });
            });
        }


        // ==========================================
        // SHOW WISH LIST COURSE DETAIL POPUP
        // Displays all info for a course you want to play
        // ==========================================
        function showCourseDetail(courseId, listType) {
            currentListType = listType;
            
            if (listType === 'wishlist') {
                const course = wishlistCourses.find(c => c.id === courseId);
                if (!course) return;
                
                currentCourseId = courseId;
                
                const ratingLabels = {
                    must: 'üåü Must Play - Would make a special trip',
                    would: '‚≠ê Would Like to Play - If convenient',
                    nearby: '‚ú® Would Play if Nearby - If in the same city'
                };
                
                document.getElementById('modalCourseName').textContent = course.name;
                document.getElementById('modalContent').innerHTML = `
                    ${course.website ? `
                        <div class="detail-section">
                            <div class="detail-label">Website</div>
                            <div class="detail-value"><a href="${course.website}" target="_blank" style="color: #2a5298; text-decoration: underline;">${course.website}</a></div>
                        </div>
                    ` : ''}
                    
                    ${course.address ? `
                        <div class="detail-section">
                            <div class="detail-label">Address</div>
                            <div class="detail-value">${course.address}</div>
                        </div>
                    ` : ''}
                    
                    ${course.city ? `
                        <div class="detail-section">
                            <div class="detail-label">City</div>
                            <div class="detail-value">${course.city}</div>
                        </div>
                    ` : ''}
                    
                    ${course.state ? `
                        <div class="detail-section">
                            <div class="detail-label">State</div>
                            <div class="detail-value">${course.state}</div>
                        </div>
                    ` : ''}
                    
                    ${course.country ? `
                        <div class="detail-section">
                            <div class="detail-label">Country</div>
                            <div class="detail-value">${course.country}</div>
                        </div>
                    ` : ''}
                    
                    ${course.rating ? `
                        <div class="detail-section">
                            <div class="detail-label">Rating</div>
                            <div class="detail-value">${ratingLabels[course.rating]}</div>
                        </div>
                    ` : ''}
                    
                    ${course.heardFrom ? `
                        <div class="detail-section">
                            <div class="detail-label">Heard From</div>
                            <div class="detail-value">${course.heardFrom}</div>
                        </div>
                    ` : ''}
                    
                    ${course.notes ? `
                        <div class="detail-section">
                            <div class="detail-label">Notes</div>
                            <div class="detail-value">${course.notes}</div>
                        </div>
                    ` : ''}
                    
                    <div class="detail-section">
                        <div class="detail-label">Date Added</div>
                        <div class="detail-value">${new Date(course.dateAdded).toLocaleDateString()}</div>
                    </div>
                `;
                
                // Show "Mark as Played" button for wishlist courses
                document.getElementById('btnMarkAsPlayed').style.display = 'block';
                document.getElementById('courseModal').classList.add('active');
            }
        }

        // ==========================================
        // SHOW ALL ROUNDS FOR A PLAYED COURSE
        // When you click a course from played list, show all times you played it
        // ==========================================
        function showPlayedCourseRounds(courseName) {
            const rounds = playedCourses.filter(r => r.name === courseName);
            if (rounds.length === 0) return;
            
            currentListType = 'played';
            currentCourseId = courseName; // Store course name instead of single ID
            
            // Sort by date, most recent first
            rounds.sort((a, b) => new Date(b.datePlayed) - new Date(a.datePlayed));
            
            document.getElementById('modalCourseName').textContent = courseName;
            
            const roundsHtml = rounds.map((round, index) => {
                // Build location string
                let locationStr = '';
                if (round.city || round.state || round.country) {
                    const parts = [];
                    if (round.city) parts.push(round.city);
                    if (round.state) parts.push(round.state);
                    if (round.country) parts.push(round.country);
                    locationStr = parts.join(', ');
                }
                
                return `
                    <div class="detail-section" style="border-bottom: ${index < rounds.length - 1 ? '1px solid #e0e0e0' : 'none'}; padding-bottom: ${index < rounds.length - 1 ? '20px' : '0'}; margin-bottom: ${index < rounds.length - 1 ? '20px' : '0'};">
                        <div style="font-weight: 700; color: #1e3c72; margin-bottom: 12px;">Round ${index + 1} - ${new Date(round.datePlayed).toLocaleDateString()}</div>
                        
                        ${round.website ? `
                            <div style="margin-bottom: 8px;">
                                <span style="font-weight: 600; color: #666; font-size: 13px;">WEBSITE: </span>
                                <a href="${round.website}" target="_blank" style="color: #2a5298; text-decoration: underline;">${round.website}</a>
                            </div>
                        ` : ''}
                        
                        ${round.holes ? `
                            <div style="margin-bottom: 8px;">
                                <span style="font-weight: 600; color: #666; font-size: 13px;">HOLES: </span>
                                <span>${round.holes} holes</span>
                            </div>
                        ` : ''}
                        
                        ${round.score ? `
                            <div style="margin-bottom: 8px;">
                                <span style="font-weight: 600; color: #666; font-size: 13px;">SCORE: </span>
                                <span>${round.score}</span>
                            </div>
                        ` : ''}
                        
                        ${round.playedWith ? `
                            <div style="margin-bottom: 8px;">
                                <span style="font-weight: 600; color: #666; font-size: 13px;">PLAYED WITH: </span>
                                <span>${Array.isArray(round.playedWith) 
                                    ? round.playedWith.map(function(p) {
                                        let parts = [p.name];
                                        if (p.company) parts.push(p.company);
                                        if (p.email) parts.push(p.email);
                                        return parts.join(' ‚Äî ');
                                    }).join('; ')
                                    : round.playedWith}</span>
                            </div>
                        ` : ''}
                        
                        ${round.address ? `
                            <div style="margin-bottom: 8px;">
                                <span style="font-weight: 600; color: #666; font-size: 13px;">ADDRESS: </span>
                                <span>${round.address}</span>
                            </div>
                        ` : ''}
                        
                        ${locationStr ? `
                            <div style="margin-bottom: 8px;">
                                <span style="font-weight: 600; color: #666; font-size: 13px;">LOCATION: </span>
                                <span>${locationStr}</span>
                            </div>
                        ` : ''}
                        
                        ${round.notes ? `
                            <div style="margin-top: 12px;">
                                <div style="font-weight: 600; color: #666; font-size: 13px; margin-bottom: 4px;">NOTES:</div>
                                <div>${round.notes}</div>
                            </div>
                        ` : ''}
                        ${round.photos && round.photos.length > 0 ? `
                            <div style="margin-top: 12px;">
                                <div style="font-weight: 600; color: #666; font-size: 13px; margin-bottom: 8px;">PHOTOS:</div>
                                <div class="detail-photos">
                                    ${round.photos.map(function(photo, pIdx) {
                                        return '<img class="detail-photo" src="' + photo + '" onclick="showPhotoViewer(\'' + pIdx + '_detail\')" />';
                                    }).join('')}
                                </div>
                            </div>
                        ` : ''}
                    </div>
                `;
            }).join('');
            
            document.getElementById('modalContent').innerHTML = `
                <div style="margin-bottom: 12px; color: #666;">
                    Played ${rounds.length} time${rounds.length > 1 ? 's' : ''}
                </div>
                ${roundsHtml}
            `;
            
            // Hide "Mark as Played" button for played courses
            document.getElementById('btnMarkAsPlayed').style.display = 'none';
            document.getElementById('courseModal').classList.add('active');
        }

        // ==========================================
        // CLOSE POPUP BUTTONS
        // Different ways to close the detail popup
        // ==========================================
        document.getElementById('btnCloseModal').addEventListener('click', function() {
            document.getElementById('courseModal').classList.remove('active');
        });

        document.getElementById('courseModal').addEventListener('click', function(e) {
            if (e.target === this) {
                this.classList.remove('active');
            }
        });

        // ==========================================
        // MARK AS PLAYED BUTTON
        // Moves a course from wish list to the add form (played mode)
        // Pre-fills the course name so you can add round details
        // ==========================================
        document.getElementById('btnMarkAsPlayed').addEventListener('click', function() {
            // Find the course on the wish list
            const course = wishlistCourses.find(c => c.id === currentCourseId);
            if (!course) return;
            
            // Close the modal
            document.getElementById('courseModal').classList.remove('active');
            
            // Switch to Add form
            document.getElementById('btnShowAdd').click();
            
            // Select "Played" option
            document.querySelector('input[name="listType"][value="played"]').checked = true;
            document.querySelector('input[name="listType"][value="played"]').closest('.list-type-option').classList.add('selected');
            document.querySelector('input[name="listType"][value="wishlist"]').closest('.list-type-option').classList.remove('selected');
            showPlayedFields();
            
            // Pre-fill the course name
            document.getElementById('courseName').value = course.name;
            
            // Pre-fill location fields if available
            if (course.address) {
                document.getElementById('address').value = course.address;
            }
            if (course.city) {
                document.getElementById('city').value = course.city;
            }
            if (course.state) {
                document.getElementById('state').value = course.state;
            }
            if (course.country) {
                document.getElementById('country').value = course.country;
            }
            
            // Set today's date as default
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('datePlayed').value = today;
            
            // Scroll to top of form
            window.scrollTo({ top: 0, behavior: 'smooth' });
            
            // Optional: Ask if they want to remove from wish list after adding
            // We'll handle this after they submit the form
            sessionStorage.setItem('moveFromWishlist', currentCourseId);
        });

        // ==========================================
        // DELETE COURSE/ROUNDS BUTTON
        // Delete from wish list or all rounds of a played course
        // ==========================================
        document.getElementById('btnDeleteCourse').addEventListener('click', function() {
            if (currentListType === 'wishlist') {
                if (confirm('Are you sure you want to delete this course from your wish list?')) {
                    wishlistCourses = wishlistCourses.filter(c => c.id !== currentCourseId);
                    saveData();
                    renderWishList();
                    document.getElementById('courseModal').classList.remove('active');
                }
            } else if (currentListType === 'played') {
                const courseName = currentCourseId; // currentCourseId stores course name for played
                const roundCount = playedCourses.filter(r => r.name === courseName).length;
                
                if (confirm(`Are you sure you want to delete all ${roundCount} round${roundCount > 1 ? 's' : ''} at ${courseName}?`)) {
                    playedCourses = playedCourses.filter(r => r.name !== courseName);
                    saveData();
                    renderPlayedList();
                    document.getElementById('courseModal').classList.remove('active');
                }
            }
        });

        // ==========================================
        // EDIT COURSE BUTTON
        // Opens the form with existing course data pre-filled for editing
        // ==========================================
        document.getElementById('btnEditCourse').addEventListener('click', function() {
            // Close modal
            document.getElementById('courseModal').classList.remove('active');
            
            // Switch to Add form
            document.getElementById('btnShowAdd').click();
            
            if (currentListType === 'wishlist') {
                const course = wishlistCourses.find(c => c.id === currentCourseId);
                if (!course) return;
                
                // Select wishlist option
                document.querySelector('input[name="listType"][value="wishlist"]').checked = true;
                document.querySelector('input[name="listType"][value="wishlist"]').closest('.list-type-option').classList.add('selected');
                document.querySelector('input[name="listType"][value="played"]').closest('.list-type-option').classList.remove('selected');
                showWishlistFields();
                
                // Pre-fill all fields
                document.getElementById('courseName').value = course.name || '';
                document.getElementById('address').value = course.address || '';
                document.getElementById('city').value = course.city || '';
                document.getElementById('state').value = course.state || '';
                document.getElementById('country').value = course.country || '';
                document.getElementById('website').value = course.website || '';
                document.getElementById('heardFrom').value = course.heardFrom || '';
                document.getElementById('wishlistNotes').value = course.notes || '';
                
                // Set rating
                if (course.rating) {
                    const ratingRadio = document.querySelector(`input[name="rating"][value="${course.rating}"]`);
                    if (ratingRadio) {
                        ratingRadio.checked = true;
                        ratingRadio.closest('.rating-option').classList.add('selected');
                    }
                }
                
                // Track that we're editing (don't delete yet ‚Äî only replace on submit)
                editingId = currentCourseId;
                editingType = 'wishlist';
                document.getElementById('btnSubmitCourse').textContent = 'Save Changes';
                document.getElementById('btnDeleteFromForm').style.display = 'block';
                
            } else if (currentListType === 'played') {
                // For played courses, we need to handle multiple rounds
                // We'll just edit the most recent round for now
                const rounds = playedCourses.filter(r => r.name === currentCourseId);
                if (rounds.length === 0) return;
                
                const mostRecent = rounds.sort((a, b) => new Date(b.datePlayed) - new Date(a.datePlayed))[0];
                
                // Select played option
                document.querySelector('input[name="listType"][value="played"]').checked = true;
                document.querySelector('input[name="listType"][value="played"]').closest('.list-type-option').classList.add('selected');
                document.querySelector('input[name="listType"][value="wishlist"]').closest('.list-type-option').classList.remove('selected');
                showPlayedFields();
                
                // Pre-fill all fields
                document.getElementById('courseName').value = mostRecent.name || '';
                document.getElementById('address').value = mostRecent.address || '';
                document.getElementById('city').value = mostRecent.city || '';
                document.getElementById('state').value = mostRecent.state || '';
                document.getElementById('country').value = mostRecent.country || '';
                document.getElementById('website').value = mostRecent.website || '';
                document.getElementById('datePlayed').value = mostRecent.datePlayed || '';
                document.getElementById('score').value = mostRecent.score || '';
                document.getElementById('playedNotes').value = mostRecent.notes || '';
                
                // Load the players array for editing
                if (Array.isArray(mostRecent.playedWith)) {
                    playersArray = mostRecent.playedWith.slice();
                } else if (typeof mostRecent.playedWith === 'string' && mostRecent.playedWith) {
                    // Convert legacy string format to array
                    playersArray = mostRecent.playedWith.split(',').map(function(name) {
                        return { name: name.trim(), company: '', email: '' };
                    });
                } else {
                    playersArray = [];
                }
                renderPlayersList();
                
                // Load photos for editing
                if (Array.isArray(mostRecent.photos)) {
                    photosArray = mostRecent.photos.slice();
                } else {
                    photosArray = [];
                }
                renderPhotosPreview();
                
                // Set holes
                if (mostRecent.holes) {
                    const holesRadio = document.querySelector(`input[name="holes"][value="${mostRecent.holes}"]`);
                    if (holesRadio) {
                        holesRadio.checked = true;
                        holesRadio.closest('.rating-option').classList.add('selected');
                    }
                }
                
                // Track that we're editing (don't delete yet ‚Äî only replace on submit)
                editingId = mostRecent.id;
                editingType = 'played';
                document.getElementById('btnSubmitCourse').textContent = 'Save Changes';
                document.getElementById('btnDeleteFromForm').style.display = 'block';
            }
            
            // Scroll to top of form
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // ==========================================
        // DELETE FROM EDIT FORM
        // Only visible when editing an existing course
        // ==========================================
        document.getElementById('btnDeleteFromForm').addEventListener('click', function() {
            if (!editingId) return;
            
            if (editingType === 'wishlist') {
                if (confirm('Are you sure you want to delete this course from your wish list?')) {
                    wishlistCourses = wishlistCourses.filter(function(c) { return c.id !== editingId; });
                    saveData();
                    renderWishList();
                    
                    // Reset form and go back to wish list
                    editingId = null;
                    editingType = null;
                    document.getElementById('courseForm').reset();
                    document.getElementById('btnSubmitCourse').textContent = 'Add Course';
                    this.style.display = 'none';
                    playersArray = [];
                    renderPlayersList();
                    photosArray = [];
                    renderPhotosPreview();
                    document.getElementById('btnShowWishList').click();
                    showWishlistFields();
                }
            } else if (editingType === 'played') {
                if (confirm('Are you sure you want to delete this round?')) {
                    playedCourses = playedCourses.filter(function(r) { return r.id !== editingId; });
                    saveData();
                    renderPlayedList();
                    
                    // Reset form and go back to played list
                    editingId = null;
                    editingType = null;
                    document.getElementById('courseForm').reset();
                    document.getElementById('btnSubmitCourse').textContent = 'Add Course';
                    this.style.display = 'none';
                    playersArray = [];
                    renderPlayersList();
                    photosArray = [];
                    renderPhotosPreview();
                    document.getElementById('btnShowPlayedList').click();
                    showWishlistFields();
                }
            }
        });
    </script>
</body>
</html>